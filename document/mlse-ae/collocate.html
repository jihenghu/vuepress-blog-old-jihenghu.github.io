<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Res1 融合(Collocation)处理说明 | HERRERA21</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/logo_1.jpg">
    <meta name="description" content="Do not go gentle into that good night">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.b766760d.css" as="style"><link rel="preload" href="/assets/js/app.84efe3cb.js" as="script"><link rel="preload" href="/assets/js/3.a3aaa010.js" as="script"><link rel="preload" href="/assets/js/1.f6ff2096.js" as="script"><link rel="preload" href="/assets/js/23.d1a88016.js" as="script"><link rel="prefetch" href="/assets/js/10.910481d9.js"><link rel="prefetch" href="/assets/js/11.93284723.js"><link rel="prefetch" href="/assets/js/12.e7736cc1.js"><link rel="prefetch" href="/assets/js/13.17355dd0.js"><link rel="prefetch" href="/assets/js/14.85884ad0.js"><link rel="prefetch" href="/assets/js/15.1bfd135b.js"><link rel="prefetch" href="/assets/js/16.1ec90c07.js"><link rel="prefetch" href="/assets/js/17.079f4d4c.js"><link rel="prefetch" href="/assets/js/18.7cb12f6d.js"><link rel="prefetch" href="/assets/js/19.94499731.js"><link rel="prefetch" href="/assets/js/20.7b1459b5.js"><link rel="prefetch" href="/assets/js/21.3ee3a6e7.js"><link rel="prefetch" href="/assets/js/22.6e66727b.js"><link rel="prefetch" href="/assets/js/24.6805c447.js"><link rel="prefetch" href="/assets/js/25.672046e4.js"><link rel="prefetch" href="/assets/js/26.811ff7a8.js"><link rel="prefetch" href="/assets/js/27.602fcbf5.js"><link rel="prefetch" href="/assets/js/28.f3b6cf79.js"><link rel="prefetch" href="/assets/js/29.17eb6a32.js"><link rel="prefetch" href="/assets/js/30.348b5dc5.js"><link rel="prefetch" href="/assets/js/31.7c5b8704.js"><link rel="prefetch" href="/assets/js/32.23aa9611.js"><link rel="prefetch" href="/assets/js/33.7512e85b.js"><link rel="prefetch" href="/assets/js/34.1d9445c2.js"><link rel="prefetch" href="/assets/js/35.c268eff8.js"><link rel="prefetch" href="/assets/js/36.1e0f3a32.js"><link rel="prefetch" href="/assets/js/37.ee7e9551.js"><link rel="prefetch" href="/assets/js/38.8fc26356.js"><link rel="prefetch" href="/assets/js/39.376bc501.js"><link rel="prefetch" href="/assets/js/4.3c60d52f.js"><link rel="prefetch" href="/assets/js/40.79ec5ca8.js"><link rel="prefetch" href="/assets/js/41.b6826f81.js"><link rel="prefetch" href="/assets/js/42.8edec565.js"><link rel="prefetch" href="/assets/js/43.75e1b398.js"><link rel="prefetch" href="/assets/js/44.606048d9.js"><link rel="prefetch" href="/assets/js/45.52cc7a17.js"><link rel="prefetch" href="/assets/js/46.035206fe.js"><link rel="prefetch" href="/assets/js/47.af896726.js"><link rel="prefetch" href="/assets/js/48.b6ea32e9.js"><link rel="prefetch" href="/assets/js/49.8c4101b3.js"><link rel="prefetch" href="/assets/js/5.fdb8e8f3.js"><link rel="prefetch" href="/assets/js/50.fa471f22.js"><link rel="prefetch" href="/assets/js/51.4b829392.js"><link rel="prefetch" href="/assets/js/52.c6b64162.js"><link rel="prefetch" href="/assets/js/53.74ea9152.js"><link rel="prefetch" href="/assets/js/54.a705698b.js"><link rel="prefetch" href="/assets/js/55.5b6e8824.js"><link rel="prefetch" href="/assets/js/56.f502c686.js"><link rel="prefetch" href="/assets/js/57.64acd402.js"><link rel="prefetch" href="/assets/js/58.13178010.js"><link rel="prefetch" href="/assets/js/59.7c77b928.js"><link rel="prefetch" href="/assets/js/6.b3240ba5.js"><link rel="prefetch" href="/assets/js/60.eb58b247.js"><link rel="prefetch" href="/assets/js/61.da17a9ec.js"><link rel="prefetch" href="/assets/js/62.01a37a3c.js"><link rel="prefetch" href="/assets/js/63.242e8fb8.js"><link rel="prefetch" href="/assets/js/64.57ecb7c4.js"><link rel="prefetch" href="/assets/js/65.963a41ea.js"><link rel="prefetch" href="/assets/js/66.c4d00490.js"><link rel="prefetch" href="/assets/js/67.c91612ef.js"><link rel="prefetch" href="/assets/js/68.b34c0e86.js"><link rel="prefetch" href="/assets/js/69.55ba8c4c.js"><link rel="prefetch" href="/assets/js/7.f8982902.js"><link rel="prefetch" href="/assets/js/70.fccbe541.js"><link rel="prefetch" href="/assets/js/71.ff487847.js"><link rel="prefetch" href="/assets/js/72.a3bac733.js"><link rel="prefetch" href="/assets/js/73.2051552a.js"><link rel="prefetch" href="/assets/js/74.36d4b632.js"><link rel="prefetch" href="/assets/js/75.f7d15781.js"><link rel="prefetch" href="/assets/js/76.98571538.js"><link rel="prefetch" href="/assets/js/77.cd5b3b29.js"><link rel="prefetch" href="/assets/js/8.92693fd7.js"><link rel="prefetch" href="/assets/js/9.2c2ca473.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b766760d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>HERRERA21</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>HERRERA21</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_1.jpg" alt="HERRERA21" class="logo"> <span class="site-name">HERRERA21</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/科研/" class="nav-link"><i class="iconfont undefined"></i>
  科研
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active"><i class="iconfont reco-suggestion"></i>
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Projects🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>Notes🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learnote/" class="nav-link"><i class="iconfont undefined"></i>
  Learning notes
</a></li></ul></li><li class="dropdown-item"><h4>协同分析平台🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mpcaplas/" class="nav-link"><i class="iconfont undefined"></i>
  协同分析平台
</a></li><li class="dropdown-subitem"><a href="/mpcaplas/dataset/" class="nav-link"><i class="iconfont undefined"></i>
  后台数据集说明文档
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-message"></i>
  关于
</a></div> <a href="https://github.com/jihenghu/jihenghu.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/logo_1.jpg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    HERRERA21
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>7</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>6</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/科研/" class="nav-link"><i class="iconfont undefined"></i>
  科研
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active"><i class="iconfont reco-suggestion"></i>
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Projects🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>Notes🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learnote/" class="nav-link"><i class="iconfont undefined"></i>
  Learning notes
</a></li></ul></li><li class="dropdown-item"><h4>协同分析平台🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mpcaplas/" class="nav-link"><i class="iconfont undefined"></i>
  协同分析平台
</a></li><li class="dropdown-subitem"><a href="/mpcaplas/dataset/" class="nav-link"><i class="iconfont undefined"></i>
  后台数据集说明文档
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-message"></i>
  关于
</a></div> <a href="https://github.com/jihenghu/jihenghu.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <ul class="sidebar-links"><li><a href="/document/" aria-current="page" class="sidebar-link">文档概览</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>AMSR-E MLSE反演文档</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/mlse-ae/prefix.html" class="sidebar-link">MLSE 中国 version2 说明文档 - 前言</a></li><li><a href="/document/mlse-ae/2a.html" class="sidebar-link">AMSR-E L2A 数据预处理说明</a></li><li><a href="/document/mlse-ae/2b.html" class="sidebar-link">AMSR-E L2B 数据预处理说明</a></li><li><a href="/document/mlse-ae/06.html" class="sidebar-link">MYD06 L2 数据预处理说明</a></li><li><a href="/document/mlse-ae/20c.html" class="sidebar-link">ERA-20C 数据预处理说明</a></li><li><a href="/document/mlse-ae/collocate.html" aria-current="page" class="active sidebar-link">Res1 融合(Collocation)处理说明</a></li><li><a href="/document/mlse-ae/retrieve.html" class="sidebar-link">反演说明</a></li><li><a href="/document/mlse-ae/res3.html" class="sidebar-link">Res3 MLSE反演说明</a></li><li><a href="/document/mlse-ae/misc.html" class="sidebar-link">后期处理说明</a></li><li><a href="/document/mlse-ae/mwsim.html" class="sidebar-link">MWRT模式的安装和使用说明</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GMI MLSE反演文档</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Res1 融合(Collocation)处理说明</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>HERRERA21</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>Res1 融合(Collocation)处理说明</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>HERRERA21</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2019-06-28</span></i> <i class="iconfont reco-eye" data-v-aa64b9d0><span id="/document/mlse-ae/collocate.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-aa64b9d0><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><p></p><div class="table-of-contents"><ul><li><a href="#文件夹内容">- 文件夹内容</a></li><li><a href="#运行方式">- 运行方式</a></li><li><a href="#上游数据集">- 上游数据集</a></li><li><a href="#输出说明">- 输出说明</a></li><li><a href="#流程">- 流程</a></li><li><a href="#建议">- 建议</a></li><li><a href="#附录">-附录</a></li></ul></div><p></p> <h2 id="文件夹内容"><a href="#文件夹内容" class="header-anchor">#</a> - 文件夹内容</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>+ data           <span class="token comment"># 数据生成文件夹</span>
- collocate.f    <span class="token comment"># 主要的处理程序，fortran 77语言编写</span>
- collocate.exe  <span class="token comment"># gfortran collocate.f -o collocate.exe 生成的可执行程序</span>
- batch.sh       <span class="token comment"># 批量控制脚本</span>
- <span class="token number">20040102</span>-20040103.log  <span class="token comment"># 批量处理日志</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr> <h2 id="运行方式"><a href="#运行方式" class="header-anchor">#</a> - 运行方式</h2> <ul><li><p>单个日期处理（如2004年1月1日)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$./collocate.exe <span class="token number">20040101</span>
        <span class="token number">1511</span>         <span class="token number">911</span>
 start
 <span class="token number">20040101</span>
 <span class="token punctuation">..</span>/2b/data/AEL2B.SurfaceRain.res5km.20040101.txt             <span class="token function">open</span>
 MYD06.cloud.properties.res5km.20040101.txt                   <span class="token function">open</span>
 MYD06.cloud.properties.res5km.20040101.txt                   cloud <span class="token builtin class-name">read</span> <span class="token keyword">done</span>
 readingERA20C.EAsia.27L.12km.20040101                              
 AEL2A.masked.TB.res1.20040101.txt                            <span class="token function">open</span>
 <span class="token number">20040101</span> collocate <span class="token keyword">done</span>
 <span class="token number">20040101</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>fortran带参方式运行 ，fortran 代码内部的语句：</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code><span class="token keyword">call</span> getarg<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ymd<span class="token punctuation">)</span>      <span class="token comment">!!!数字位表示参数位置，赋值给ymd；0表示命令本身，1表示命令后的第一个参数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>./collocate.exe 20040101</code>可以将<code>20040101</code>赋值给变量ymd。</p> <p>运行结果：data文件夹下生成三个文件：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>-rw-rw-r--  <span class="token number">19</span>.37Mb ael2a.ael2b.myd06.era20c.basic.20040101.txt   <span class="token comment">#基本参数</span>
-rw-rw-r--  531Mb   ael2a.ael2b.myd06.era20c.hydro.20040101.txt   <span class="token comment">#水凝物参数</span>
-rw-rw-r--  <span class="token number">173</span>.7Mb ael2a.ael2b.myd06.era20c.profile.20040101.txt <span class="token comment">#廓线参数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>批量日期处理（如20040102~20040103）</p> <p>使用<code>batch.sh</code>脚本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$sh</span> batch.sh <span class="token number">20040102</span> <span class="token number">20040103</span>
<span class="token number">20040102</span>
<span class="token number">20040103</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>日志文件：<code>20040102-20040103.log</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>        <span class="token number">1511</span>         <span class="token number">911</span>
 start
 <span class="token number">20040102</span>
 <span class="token punctuation">..</span>/2b/data/AEL2B.SurfaceRain.res5km.20040102.txt             <span class="token function">open</span>       
 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 <span class="token number">20040103</span>
 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 <span class="token number">20040103</span> collocate <span class="token keyword">done</span>
 <span class="token number">20040103</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>collocation的过程会消耗很多空间，注意规划。</p></li></ul> <hr> <h2 id="上游数据集"><a href="#上游数据集" class="header-anchor">#</a> - 上游数据集</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token punctuation">..</span>/2a.res1/AEL2A.masked.TB.res1.20040101.txt           <span class="token comment"># AE-L2a 预处理产物 txt</span>
 <span class="token punctuation">..</span>/2b/data/AEL2B.SurfaceRain.res5km.20040101.txt       <span class="token comment"># AE-Rain 预处理产物 txt </span>
 <span class="token punctuation">..</span>/06/MYD06.cloud.properties.res5km.20040101.txt       <span class="token comment"># MYD06 云产品预处理产物   txt  </span>
 <span class="token punctuation">..</span>/20c/readingERA20C.EAsia.27L.12km.20040101           <span class="token comment"># ERA-20C 预处理廓线   二进制</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>读取示例：</p> <ul><li><p>AE-Rain：</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code> <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">end</span><span class="token operator">=</span><span class="token number">1101</span><span class="token punctuation">)</span>ip<span class="token punctuation">,</span> lon<span class="token punctuation">,</span>lat<span class="token punctuation">,</span>raintime<span class="token punctuation">,</span>rr<span class="token punctuation">,</span>frcc 
 <span class="token comment">!!202389  118.651375   10.526302    5.750000    0.000000    0.000000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>AE-L2a:</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code> <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">end</span><span class="token operator">=</span><span class="token number">1103</span><span class="token punctuation">)</span>ip<span class="token punctuation">,</span>lon<span class="token punctuation">,</span>lat<span class="token punctuation">,</span><span class="token punctuation">(</span>tb<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>stime<span class="token punctuation">,</span>frcland
 <span class="token comment">!!    22  143.824844   49.743305  251.199997  236.269989  250.589996  237.440002  249.099991  236.299988  248.380005  236.319992  243.739990  232.899994  233.130005  225.910004    2.666667   95.000000                    </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>MYD06</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code> <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">end</span><span class="token operator">=</span><span class="token number">1201</span><span class="token punctuation">)</span> ip<span class="token punctuation">,</span>lon<span class="token punctuation">,</span>lat<span class="token punctuation">,</span>tcloud<span class="token punctuation">,</span>cwp<span class="token punctuation">,</span>cfr<span class="token punctuation">,</span>cpi<span class="token punctuation">,</span>ctp<span class="token punctuation">,</span>cth<span class="token punctuation">,</span>ctt 
                    <span class="token comment">! 1  -   -         g/m2 %   -  hpa  m   k </span>
<span class="token comment">!  25 144.8686  36.1267  2.6167  8.9167  100.000  1.000  905.000  950.000 281.3372</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>ERA -20C</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>       <span class="token keyword">real</span><span class="token operator">*</span><span class="token number">4</span>  pmb<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span>tkk<span class="token punctuation">(</span>nlon<span class="token punctuation">,</span>nlat<span class="token punctuation">,</span>L<span class="token punctuation">,</span>mt<span class="token punctuation">)</span>
      <span class="token operator">+</span>         <span class="token punctuation">,</span>rhh<span class="token punctuation">(</span>nlon<span class="token punctuation">,</span>nlat<span class="token punctuation">,</span>L<span class="token punctuation">,</span>mt<span class="token punctuation">)</span><span class="token punctuation">,</span>zz<span class="token punctuation">(</span>nlon<span class="token punctuation">,</span>nlat<span class="token punctuation">,</span>L<span class="token punctuation">,</span>mt<span class="token punctuation">)</span>
       <span class="token keyword">real</span><span class="token operator">*</span><span class="token number">4</span>  late<span class="token punctuation">(</span>nlat<span class="token punctuation">)</span><span class="token punctuation">,</span>lone<span class="token punctuation">(</span>nlon<span class="token punctuation">)</span> 
       <span class="token keyword">real</span><span class="token operator">*</span><span class="token number">4</span>  psurf<span class="token punctuation">(</span>nlon<span class="token punctuation">,</span>nlat<span class="token punctuation">,</span>mt<span class="token punctuation">)</span><span class="token punctuation">,</span> skt<span class="token punctuation">(</span>nlon<span class="token punctuation">,</span>nlat<span class="token punctuation">,</span>mt<span class="token punctuation">)</span>
      <span class="token operator">+</span>         <span class="token punctuation">,</span>wndg<span class="token punctuation">(</span>nlon<span class="token punctuation">,</span>nlat<span class="token punctuation">,</span>mt<span class="token punctuation">)</span><span class="token punctuation">,</span>t2mg<span class="token punctuation">(</span>nlon<span class="token punctuation">,</span>nlat<span class="token punctuation">,</span>mt<span class="token punctuation">)</span> 
     
       <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token keyword">file</span><span class="token operator">=</span> ecmwf<span class="token punctuation">,</span>form<span class="token operator">=</span><span class="token string">&quot;unformatted&quot;</span><span class="token punctuation">,</span>access<span class="token operator">=</span><span class="token string">&quot;sequential&quot;</span><span class="token punctuation">,</span>ERR<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">)</span>		  
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> pmb
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> tkk
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> zz
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> rhh
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> psurf
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> skt
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> t2mg
	         <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> wndg	    		       		 
		     <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> late
             <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> lone 
	         <span class="token keyword">close</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul> <hr> <h2 id="输出说明"><a href="#输出说明" class="header-anchor">#</a> - 输出说明</h2> <ul><li><p>输出列表</p> <div class="language-fortran 77 line-numbers-mode"><pre class="language-fortran"><code>  <span class="token comment">! do loop for every sample:</span>
         <span class="token keyword">write</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">888</span><span class="token punctuation">)</span>ip<span class="token punctuation">,</span>lon<span class="token punctuation">,</span>lat<span class="token punctuation">,</span>stime<span class="token punctuation">,</span>LST<span class="token punctuation">,</span>wnd<span class="token punctuation">,</span>t2m<span class="token punctuation">,</span>skp<span class="token punctuation">,</span>cwc<span class="token punctuation">,</span>cic<span class="token punctuation">,</span>frcland   <span class="token comment">!!输出基本参数</span>
  <span class="token comment">!分别是：序号，经度，纬度，扫描时刻（UTC hr），地表温度（K），10m风速（m/s），2m温度（K）</span>
  <span class="token comment">!       地表气压（hpa），液态水路径（g/m2），冰态水路径（g/m2）, 陆地分数（%）    </span>
<span class="token number">888</span>	      <span class="token keyword">format</span><span class="token punctuation">(</span>I6<span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">(</span><span class="token number">1</span>x<span class="token punctuation">,</span>f14.<span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">!!输出示例：</span>
<span class="token comment">!!95       140.0084        36.1518         3.3167       283.6469         2.9410       !!279.1640       971.9497         0.0000         0.0000        99.0000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code> <span class="token comment">!!!输出廓线和亮温   </span>
<span class="token keyword">write</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">999</span><span class="token punctuation">)</span>ip<span class="token punctuation">,</span>newl<span class="token punctuation">,</span><span class="token punctuation">(</span>tk<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>rh<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>z<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>tb<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>           <span class="token comment">!分别是：序号，有效层数，气温廓线（L*K)，相对湿度廓线（L*%），高度廓线（L*m）,亮温谱（12*k）</span>

 <span class="token comment">!!!输出水凝物廓线</span>
<span class="token keyword">write</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">999</span><span class="token punctuation">)</span>ip<span class="token punctuation">,</span>qc <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>CldWtr<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span>CldIce<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token comment">!分别是：序号，天气类型，云水数组，云冰数组。    </span>
    
<span class="token number">999</span>	      <span class="token keyword">format</span><span class="token punctuation">(</span>I6<span class="token punctuation">,</span>I6<span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">(</span><span class="token number">1</span>x<span class="token punctuation">,</span>f14.<span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <hr> <h2 id="流程"><a href="#流程" class="header-anchor">#</a> - 流程</h2> <p>几种数据的融合可以分为以下几个步骤:</p> <ol><li><p>确定一个5km分辨率（0.05<sup>o</sup>）的标准网格,涵盖所有待反演的区域，我们将此网格成为操作网格。</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>      lonmin<span class="token operator">=</span><span class="token number">70</span>
      lonmax<span class="token operator">=</span><span class="token number">145</span>
      latmin<span class="token operator">=</span><span class="token number">10</span>
      latmax <span class="token operator">=</span><span class="token number">55</span>
	  nx <span class="token operator">=</span> <span class="token punctuation">(</span>lonmax<span class="token operator">-</span>lonmin <span class="token punctuation">)</span><span class="token operator">/</span>d0 <span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">10</span>  <span class="token comment">!1511</span>
	  ny <span class="token operator">=</span> <span class="token punctuation">(</span>latmax<span class="token operator">-</span>latmin <span class="token punctuation">)</span><span class="token operator">/</span>d0 <span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">10</span>  <span class="token comment">!911</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>为了防止下标越界，初始网格两侧各增加5个格点，实际上不会匹配到降水和云，但是在对AMSR-E像斑做5个格点半径平均时可以防止边界溢出。</p></li> <li><p>将AE-Rain的降水资料匹配进5km的操作网格，有降水存在的格点rainflag标记为+1。</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>rexist <span class="token operator">=</span><span class="token number">0</span>     <span class="token comment">!格点是否有降水观测数据 ，只有降水数据存在，才会对格点进行处理</span>
rainflag<span class="token operator">=</span><span class="token number">0</span>    <span class="token comment">!格点是否有降水， 存在降水则不处理格点</span>
rtime <span class="token operator">=</span> <span class="token number">0</span>     <span class="token comment">!降水数据的观测时间，用于匹配云参数和亮温参数，保证轨道唯一性。</span>
....
irx<span class="token operator">=</span>int<span class="token punctuation">(</span>aint<span class="token punctuation">(</span><span class="token punctuation">(</span>lon<span class="token operator">-</span>lonmin<span class="token punctuation">)</span><span class="token operator">/</span>d0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">5</span>  <span class="token comment">!定位所在的网格下标</span>
iry<span class="token operator">=</span>int<span class="token punctuation">(</span>aint<span class="token punctuation">(</span><span class="token punctuation">(</span>lat<span class="token operator">-</span>latmin<span class="token punctuation">)</span><span class="token operator">/</span>d0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">5</span>
rexist<span class="token punctuation">(</span>irx<span class="token punctuation">,</span>iry<span class="token punctuation">)</span> <span class="token operator">=</span> rexist<span class="token punctuation">(</span>irx<span class="token punctuation">,</span>iry<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>        
rtime<span class="token punctuation">(</span>irx<span class="token punctuation">,</span>iry<span class="token punctuation">)</span>  <span class="token operator">=</span> rtime<span class="token punctuation">(</span>irx<span class="token punctuation">,</span>iry<span class="token punctuation">)</span><span class="token operator">+</span>raintime  <span class="token comment">!without normalized</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>rr <span class="token operator">.ne.</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token keyword">then</span>		 
    rainflag<span class="token punctuation">(</span>irx<span class="token punctuation">,</span>iry<span class="token punctuation">)</span><span class="token operator">=</span>rainflag<span class="token punctuation">(</span>irx<span class="token punctuation">,</span>iry<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>	<span class="token comment">! rain point affects only 1 grid </span>
<span class="token keyword">end if</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>**特别说明，AE-Rain的空间分辨率在5km和10km之间，所以并不是如图1显示的每个格点都有降水观测。**操作网格只是用来定位四种不同的数据集，我们的操作重点是AE-L2A观测样本定位到的格点，不关心每个具体操作格点是否实际会用到。</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4lpvcmvhhj31bl0f8tck.jpg"></li></ol> <p style="text-align:center;color:navy;">图1. 左：AE-Rain匹配进操作网格。右：将有降水发生的格点标记</p> <ol start="3"><li><p>将MYD06观测匹配进操作网格，对于没有降水观测的格点（rexist=0）不做匹配，对有降水发生的格点（rexist!=0 &amp;&amp; rainflag !=0）不做匹配。</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  icx<span class="token operator">=</span>int<span class="token punctuation">(</span>aint<span class="token punctuation">(</span><span class="token punctuation">(</span>lon<span class="token operator">-</span>lonmin<span class="token punctuation">)</span><span class="token operator">/</span>d0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">5</span>  <span class="token comment">! d0=0.05</span>
  icy<span class="token operator">=</span>int<span class="token punctuation">(</span>aint<span class="token punctuation">(</span><span class="token punctuation">(</span>lat<span class="token operator">-</span>latmin<span class="token punctuation">)</span><span class="token operator">/</span>d0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">5</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> rexist<span class="token punctuation">(</span>icx<span class="token punctuation">,</span>icy<span class="token punctuation">)</span><span class="token operator">.ne.</span><span class="token number">0</span> <span class="token operator">.and.</span>  rainflag<span class="token punctuation">(</span>icx<span class="token punctuation">,</span>icy<span class="token punctuation">)</span><span class="token operator">.eq.</span><span class="token number">0</span> <span class="token operator">.and.</span> <span class="token punctuation">&amp;</span>
  		abs<span class="token punctuation">(</span>rtime<span class="token punctuation">(</span>icx<span class="token punctuation">,</span>icy<span class="token punctuation">)</span><span class="token operator">/</span>rexist<span class="token punctuation">(</span>icx<span class="token punctuation">,</span>icy<span class="token punctuation">)</span><span class="token operator">-</span>tcloud<span class="token punctuation">)</span> <span class="token operator">.le.</span> <span class="token number">0.2</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
 	 	<span class="token comment">!!对云进行平均的处理见下文步骤4</span>
  <span class="token keyword">end if</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><img src="https://ws1.sinaimg.cn/large/005zDzHply1g4lpu8aeehj31b30f70we.jpg"> <p style="text-align:center;color:navy;">图2. 左：将MYD06云观测匹配进操作网格。右：平均落入各格点的云参数，有降水的格点进行缺测</p> <p><code>abs(rtime(icx,icy)/rexist(icx,icy)-tcloud) .le. 0.2)</code>可以保证降水观测和云观测的时间保持在12min内，这远远小于Aqua的轨道周期（约90min），保证降水信息和云参数是在同一个Aqua轨道观测的。从而解决了<strong>图3</strong>中轨道重叠的问题。</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4gv7qipbzj30nf0hhjwf.jpg" style="height:300px;width:800px;"> <p style="text-align:center;color:navy;">图3. 可以看到MODIS和AMSR-E的轨道在北部有较大面积的异轨重叠，极有可能导致左边轨道的MODIS匹配到右边轨道的AMSR-E</p></li> <li><p>对云进行50km X 50km面积的格点平均。如图4，对于任意一个操作格点，我们会讲10X10格点范围内的云参数平均中赋给当前格点，这样在亮温产品落进该格点时，它就会自动匹配到50km半径内的云参数平均值。折合卫星视场EFOV的尺寸一致。（实际上是利用正方形代替圆形的方法，但是面积要稍大一些，注意，图中的EFOV为RES3的像斑示例）</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4lridf477j30jk0aedhl.jpg" style="height:300px;"> <p style="text-align:center;color:navy;">图4.将AE-L2A的亮温观测定位到网格内，对EFOV内部的操作格点进行云参数的平均(此图以RES3为例)</p> <ul><li>对AMSR-E像斑中云的平均处理</li></ul> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>ik<span class="token operator">=</span><span class="token number">6</span> 
<span class="token keyword">if</span><span class="token punctuation">(</span>cpi<span class="token operator">.eq.</span><span class="token number">0</span> <span class="token punctuation">)</span>              ik<span class="token operator">=</span><span class="token number">4</span>  <span class="token comment">! clear</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>cpi<span class="token operator">.eq.</span><span class="token number">1</span> <span class="token operator">.or.</span> cpi<span class="token operator">.eq.</span><span class="token number">5</span><span class="token punctuation">)</span> ik<span class="token operator">=</span><span class="token number">1</span>  <span class="token comment">! water phase</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>cpi<span class="token operator">.eq.</span><span class="token number">2</span> <span class="token operator">.or.</span> cpi<span class="token operator">.eq.</span><span class="token number">4</span><span class="token punctuation">)</span> ik<span class="token operator">=</span><span class="token number">2</span>  <span class="token comment">! ice phase</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>cpi<span class="token operator">.eq.</span><span class="token number">3</span> <span class="token punctuation">)</span>              ik<span class="token operator">=</span><span class="token number">3</span>  <span class="token comment">! mixed phase</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>cpi<span class="token operator">.eq.</span><span class="token number">6</span> <span class="token operator">.or.</span> cpi<span class="token operator">.eq.</span><span class="token number">127</span><span class="token punctuation">)</span> ik<span class="token operator">=</span><span class="token number">5</span> <span class="token comment">!uncertain or FillValue </span>
<span class="token comment">! these two conditions should be seperated	      </span>

<span class="token keyword">do</span> i <span class="token operator">=</span> icx<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span>icx<span class="token operator">+</span><span class="token number">5</span>
    <span class="token keyword">do</span> j <span class="token operator">=</span> icy <span class="token operator">-</span><span class="token number">5</span> <span class="token punctuation">,</span>icy <span class="token operator">+</span><span class="token number">5</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rainflag<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span> <span class="token operator">.gt.</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">cycle</span>		 
        fcwp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">=</span>fcwp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">+</span>cwp<span class="token operator">*</span>cfr<span class="token operator">/</span><span class="token number">100</span>  
        <span class="token comment">! the original CWP was normalized   by the cloud fraction</span>
        fctp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">=</span>fctp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">+</span>ctp
        fctt<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">=</span>fctt<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">+</span>ctt
        frc<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">=</span>frc<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">+</span>cfr       <span class="token comment">! 0-100</span>
        Ncloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">=</span>Ncloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>ik<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>   <span class="token comment">! modis pixel in each phase</span>
        Tncloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token operator">=</span>Tncloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>       <span class="token comment">! total modis pixel in given 0.05 x 0.05 grid, should be &gt;=1, but around 1  	  </span>
    <span class="token keyword">end do</span>
<span class="token keyword">end do</span>
......
<span class="token comment">!!!全部云参数撒入操作格点完毕后进行归一化</span>

<span class="token comment">!!!   average cloud properties in each 0.5 by 0.5 box, all parameters are initialized as zero already      </span>
      <span class="token keyword">do</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>nx 
          <span class="token keyword">do</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>ny
              <span class="token keyword">do</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span>Ncloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">.ge.</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token comment">!  if Ncloud=0, all parameter were as initialized, i.e. zero, will ctt=0 a problem?'</span>
                      fcwp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>fcwp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">/</span>TNcloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span> 
                      <span class="token comment">! cwp and frc should be averaged to the whole grid</span>
	                  fctt<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>fctt<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">/</span>Ncloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span>
	                  fctp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>fctp<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">/</span>Ncloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span>
                      frc<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token operator">=</span>frc<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token operator">/</span>TNcloud<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
                  <span class="token keyword">endif</span>
              <span class="token keyword">end do</span>
          <span class="token keyword">end do</span>
       <span class="token keyword">end do</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>对于6个归类后的相态ik，云参数的平均是分开的。</p></li> <li><p>引入ERA-20c数据和EC0.125<sup>o</sup>网格，该数据是全天全区域的数据，先行导入的目的是避免针对不同的亮温观测反复导入，提升效率。我们只需要针对每个亮温确定网格下标和时间下标就可以重复利用导入的廓线数组。</p></li> <li><p>逐条导入需要匹配的AE-L2a数据元，确定 其在操作网格上的格点，匹配云产品信息。</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>	       iix<span class="token operator">=</span>int<span class="token punctuation">(</span>aint<span class="token punctuation">(</span><span class="token punctuation">(</span>lon<span class="token operator">-</span>lonmin<span class="token punctuation">)</span><span class="token operator">/</span>d0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">5</span>
	       iiy<span class="token operator">=</span>int<span class="token punctuation">(</span>aint<span class="token punctuation">(</span><span class="token punctuation">(</span>lat<span class="token operator">-</span>latmin<span class="token punctuation">)</span><span class="token operator">/</span>d0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">5</span>
		 
       <span class="token keyword">if</span> <span class="token punctuation">(</span> rexist<span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">)</span><span class="token operator">.ne.</span><span class="token number">0</span> <span class="token operator">.and.</span>  rainflag<span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">)</span><span class="token operator">.eq.</span><span class="token number">0</span> <span class="token operator">.and.</span>
     <span class="token operator">+</span>       abs<span class="token punctuation">(</span>rtime<span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">)</span><span class="token operator">/</span>rexist<span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">)</span><span class="token operator">-</span>stime<span class="token punctuation">)</span> <span class="token operator">.le.</span> <span class="token number">0.2</span><span class="token punctuation">)</span> <span class="token keyword">then</span>				   
			    <span class="token keyword">do</span> ik<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>
		       mcwp<span class="token punctuation">(</span>ik<span class="token punctuation">)</span> <span class="token operator">=</span> fcwp<span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">,</span>ik<span class="token punctuation">)</span>	     
	           mctt<span class="token punctuation">(</span>ik<span class="token punctuation">)</span> <span class="token operator">=</span> fctt<span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">,</span>ik<span class="token punctuation">)</span>
	           mctp<span class="token punctuation">(</span>ik<span class="token punctuation">)</span> <span class="token operator">=</span> fctp<span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">,</span>ik<span class="token punctuation">)</span>
               mfrc<span class="token punctuation">(</span>ik<span class="token punctuation">)</span> <span class="token operator">=</span> frc <span class="token punctuation">(</span>iix<span class="token punctuation">,</span>iiy<span class="token punctuation">,</span>ik<span class="token punctuation">)</span> 
		        <span class="token keyword">end do</span>		   
		     .....
        <span class="token keyword">end if</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><p>同样的，所在格点必须包含降水信息，且没有降水发生：</p> <p><code>rexist(iix,iiy).ne.0 .and. rainflag(iix,iiy).eq.0</code>；</p></li> <li><p>所在格点的降水观测和云观测和亮温观测必须在同一轨道上，使用观测时间限定:</p> <p><code>abs(rtime(iix,iiy)/rexist(iix,iiy)-stime) .le. 0.2</code>；</p></li> <li><p>对6个相态的云参数进行赋值。</p></li></ul></li> <li><p>对逐条导入的AE-L2A数据元进行再分析数据的匹配：</p> <p>在第5步中，ERA20C的资料场已经导入完毕，现在只需要确定亮温数据在EC0.125<sup>o</sup>网格上的下标和时间。</p> <ul><li><p><strong>确定下标</strong>：</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  ilon <span class="token operator">=</span> nint<span class="token punctuation">(</span><span class="token punctuation">(</span>lon<span class="token operator">-</span> minlon<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">0.125</span><span class="token punctuation">)</span> 
  ilat <span class="token operator">=</span> nint<span class="token punctuation">(</span><span class="token punctuation">(</span>maxlat<span class="token operator">-</span> lat<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">0.125</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><strong>确定时间</strong></p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>           it <span class="token operator">=</span> int<span class="token punctuation">(</span><span class="token punctuation">(</span>stime <span class="token operator">-</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3.0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>       
         	  hr1<span class="token operator">=</span><span class="token punctuation">(</span>it<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3.0</span>          <span class="token comment">! 0:00-21:00</span>
         	  hr2<span class="token operator">=</span>hr1<span class="token operator">+</span><span class="token number">3.0</span>             <span class="token comment">! 3:00 - 24:00</span>
     
              wt1<span class="token operator">=</span><span class="token punctuation">(</span>hr2<span class="token operator">-</span>stime<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3.</span>   <span class="token comment">!weight</span>
        	  wt2<span class="token operator">=</span><span class="token punctuation">(</span>stime<span class="token operator">-</span>hr1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3.</span>
     	      ih1<span class="token operator">=</span>it
     	      ih2<span class="token operator">=</span>it<span class="token operator">+</span><span class="token number">1</span>
	        <span class="token keyword">if</span> <span class="token punctuation">(</span>ih2<span class="token operator">.eq.</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
			   ih2 <span class="token operator">=</span> <span class="token number">1</span>   <span class="token comment">! not actually ...should use 00:00 of the next day,but stime usually less than 10:00 in east-asia</span>
			 <span class="token keyword">end if</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>我们需要的ih1和ih2是stime所在的两个3小时间隔下标，比如 stime=1:30，对应的ih1=1，ih2=2; stime=7:15，对应的ih1=3，ih2=4。注意，本套数据反演过程中所有的时间均为统一的UTC时间，不需要任何转化，上行轨Aqua在午后地方时的13:30左右，不存在stime在21:00和次日0:00之间的复杂情形。但是，如果使用GPM这种非太阳同步卫星，就要考虑这种问题。</p></li> <li><p><strong>抽取数据并做权重平均</strong></p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  skp<span class="token operator">=</span>wt1<span class="token operator">*</span>psurf<span class="token punctuation">(</span>ilon<span class="token punctuation">,</span>ilat<span class="token punctuation">,</span>ih1<span class="token punctuation">)</span> <span class="token operator">+</span> wt2<span class="token operator">*</span>psurf<span class="token punctuation">(</span>ilon<span class="token punctuation">,</span>ilat<span class="token punctuation">,</span>ih2<span class="token punctuation">)</span>
 <span class="token comment">!这里以时间地表气压为例，注意，权重WT1和WT2要不搞反了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>例外</strong>，参数2m温度t2m是每6小时一次数据，所以要特别处理，虽然反演过程不需要这个参数，但是未来可以用来和地基站点做LST校正：</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>            itt <span class="token operator">=</span> int<span class="token punctuation">(</span><span class="token punctuation">(</span>stime <span class="token operator">-</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">6.0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>       
         	  hr11<span class="token operator">=</span><span class="token punctuation">(</span>itt<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">6.0</span>          <span class="token comment">! 0:00-21:00</span>
         	  hr22<span class="token operator">=</span>hr11<span class="token operator">+</span><span class="token number">6.0</span>             <span class="token comment">! 6:00 - 24:00</span>
     
             wt11<span class="token operator">=</span><span class="token punctuation">(</span>hr22<span class="token operator">-</span>stime<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">6.</span>   <span class="token comment">!weight</span>
        	 wt22<span class="token operator">=</span><span class="token punctuation">(</span>stime<span class="token operator">-</span>hr11<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">6.</span>
     	      ih11<span class="token operator">=</span>itt
     	      ih22<span class="token operator">=</span>itt<span class="token operator">+</span><span class="token number">1</span>
	        <span class="token keyword">if</span> <span class="token punctuation">(</span>ih22<span class="token operator">.eq.</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
			   ih22 <span class="token operator">=</span> <span class="token number">1</span>   
			   <span class="token keyword">end if</span>
			  
<span class="token comment">!!!!        Lagrange Interpolation</span>
            t2m<span class="token operator">=</span>wt11<span class="token operator">*</span>t2mg<span class="token punctuation">(</span>ilon<span class="token punctuation">,</span>ilat<span class="token punctuation">,</span>ih11<span class="token operator">*</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>wt22<span class="token operator">*</span>t2mg<span class="token punctuation">(</span>ilon<span class="token punctuation">,</span>ilat<span class="token punctuation">,</span>ih22<span class="token operator">*</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>		 	 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul></li> <li><p>根据云类型设置水凝物参数<code>CldWtr CldIce</code>，这一部分较为复杂而且乱，有时间可以优化一下，但是改动的话极容易出错。另外在归类方案上有待商榷，这一部分会影响到数据样本的有效性问题，会有很多条件判断舍弃很多样本。但是逻辑方面没有问题。我们来分析一下这一部分：</p> <p><strong>MWSIM水凝物设置说明</strong></p> <p>在此之前，你需要先了解一下<a href="https://jihenghu.github.io/pdfs/mwsim-cloud-study.pdf" target="_blank" rel="noopener noreferrer">MWSIM模式对于水凝物廓线的使用说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，见附录。</p> <p>这里可能需要补习一下大气物理中的云物理知识，云滴谱，雨滴谱分布。这是我的设置，参考了郭静超使用的wrf云参数化方案：<img src="https://ws1.sinaimg.cn/large/005zDzHply1g4ly0a56puj311l0l9whz.jpg"></p> <hr> <p><strong>代码说明</strong></p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  newl <span class="token operator">=</span> min<span class="token punctuation">(</span>count<span class="token punctuation">(</span>rh<span class="token operator">.ge.</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token punctuation">(</span>z<span class="token operator">.ge.</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>count<span class="token punctuation">(</span>tk<span class="token operator">.ge.</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">!!!计算地形以上的有效层数</span>
  <span class="token comment">!!!初始化   CldWtr=0 ,CldIce=0</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mcwp<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">.ne.</span> <span class="token number">0.0</span> <span class="token punctuation">)</span>  <span class="token keyword">goto</span> <span class="token number">176</span> <span class="token comment">!!!第6种分类不为0，不可能。舍弃样本</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>   <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>mcwp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.ne.</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> <span class="token keyword">then</span>            
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mctp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>mctp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span>mctp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.eq.</span><span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
       	   <span class="token keyword">print</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token string">&quot;type 1 cwp/ctp unmatch-------&quot;</span><span class="token punctuation">,</span>ip  		
           <span class="token keyword">goto</span> <span class="token number">176</span>
       <span class="token keyword">endif</span>
    <span class="token keyword">end if</span>
<span class="token comment">!!!如果类1,2,3总和不为0，但是云顶气压都为0（缺测），舍弃</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>液态水云</li></ul> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code> <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>mcwp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.ne.</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> <span class="token keyword">then</span> 
 .......
 <span class="token comment">!!!! mcwp1	  处理第1种类型，也就是液态水云  </span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>mctp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">.gt.</span> pmb<span class="token punctuation">(</span>newl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span>   
     <span class="token comment">!!如果云顶气压高于最底层气压，把云放置在最底层newl</span>
         CldWtr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> CldWtr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>mcwp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>z<span class="token punctuation">(</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span>z<span class="token punctuation">(</span>newl<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token comment">!!!计算云水含量并赋值到水凝物廓线上的newl-1层处。</span>
			      CldWtr<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span>   <span class="token comment">!!!!</span>
			      CldWtr<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3.E+5</span>
			      CldWtr<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>
			      CldWtr<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>
	              qc <span class="token operator">=</span> <span class="token number">1</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mctp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">.le.</span> pmb<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">.and.</span> mctp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">.gt.</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span> 
	  <span class="token comment">!!!如果云层过高，舍弃，所以建议保留全部37层廓线，这种样本很少。   </span>
			       <span class="token keyword">goto</span> <span class="token number">176</span>		   	 
      <span class="token keyword">else</span> <span class="token comment">!!!如果云层在era廓线的某一层。</span>
		 <span class="token keyword">do</span> il <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span>  <span class="token comment">!!!对层进行循环，确定云所在层，自顶向下，1为最高层</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> mctp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">.gt.</span> pmb<span class="token punctuation">(</span>il<span class="token punctuation">)</span> <span class="token operator">.and.</span> mctp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">.le.</span> pmb<span class="token punctuation">(</span>il<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span> 			                 <span class="token comment">!!!这里使用的是气压廓线来对云定位，建议以后用高度廓线，绝对单调递减			     </span>
		      CldWtr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> CldWtr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>z<span class="token punctuation">(</span>il<span class="token punctuation">)</span><span class="token operator">-</span>z<span class="token punctuation">(</span>il<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		      <span class="token comment">!!!计算云水含量并赋值到水凝物廓线上的il层处。</span>
			          CldWtr<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span>
			          CldWtr<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3.E+5</span>
			          CldWtr<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>
			          CldWtr<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>	                				  
	            <span class="token keyword">exit</span> <span class="token comment">!找到所在层就跳出循环</span>
		     <span class="token keyword">end if</span> 
	     <span class="token keyword">end do</span>
	  <span class="token keyword">end if</span>	 
 <span class="token keyword">end if</span>
   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ul><li><p>冰态水云</p> <p>和液态水云类似，只不过需要对冰晶谱进行设置：</p></li></ul> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code> <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>mcwp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.ne.</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> <span class="token keyword">then</span> 
 .......
<span class="token comment">!!! mcwp2		   </span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>mctp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.gt.</span> pmb<span class="token punctuation">(</span>newl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span>                  
            CldIce<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>CldIce<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>mcwp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>z<span class="token punctuation">(</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span>z<span class="token punctuation">(</span>newl<span class="token punctuation">)</span><span class="token punctuation">)</span>  
			          CldIce<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span>		          
			          CldIce<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2.55E+3</span>    
			          CldIce<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>         
			          CldIce<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>         
			          CldIce<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">8</span>          
          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mctp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.le.</span> pmb<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">.and.</span> mctp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.gt.</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
<span class="token comment">!           print*,&quot;type 3 ctp2 overlow--&quot;,mctp(2),pmb(1),&quot;-------&quot;,ip				   </span>
			       <span class="token keyword">goto</span> <span class="token number">176</span>
          <span class="token keyword">else</span> 
              <span class="token keyword">do</span> il <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span> mctp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.gt.</span> pmb<span class="token punctuation">(</span>il<span class="token punctuation">)</span> <span class="token operator">.and.</span> mctp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.le.</span> pmb<span class="token punctuation">(</span>il<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span> 		
                      CldIce<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> CldIce<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>z<span class="token punctuation">(</span>il<span class="token punctuation">)</span><span class="token operator">-</span>z<span class="token punctuation">(</span>il<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                      CldIce<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span>		          
                      CldIce<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2.55E+3</span>    
                      CldIce<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>         
                      CldIce<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>         
                      CldIce<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>il<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">8</span>                         					  
                      <span class="token keyword">exit</span> 
                  <span class="token keyword">end if</span> 
              <span class="token keyword">end do</span>
		 <span class="token keyword">end if</span>	 
 <span class="token keyword">end if</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li><p>混合态（ik=3）</p> <p>混合态的处理方法是一半水一半冰，处理方法和前两个类似：</p></li></ul> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>mcwp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span> mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.ne.</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> <span class="token keyword">then</span> 
 .......
<span class="token comment">!!!mcwp3	   </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mctp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">.gt.</span> pmb<span class="token punctuation">(</span>newl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span> 
        cic <span class="token operator">=</span> cic <span class="token operator">+</span> <span class="token number">0.5</span><span class="token operator">*</span>mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        cwc <span class="token operator">=</span> cwc <span class="token operator">+</span> <span class="token number">0.5</span><span class="token operator">*</span>mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

        CldWtr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>CldWtr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token number">0.5</span><span class="token operator">*</span>mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>z<span class="token punctuation">(</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span>z<span class="token punctuation">(</span>newl<span class="token punctuation">)</span><span class="token punctuation">)</span>  
        CldWtr<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span>
        CldWtr<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3.E+5</span>
        CldWtr<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>
        CldWtr<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>

        CldIce<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> CldIce<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token number">0.5</span><span class="token operator">*</span>mcwp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>z<span class="token punctuation">(</span>newl<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span>z<span class="token punctuation">(</span>newl<span class="token punctuation">)</span><span class="token punctuation">)</span>    
        CldIce<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span>		          
        CldIce<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2.55E+3</span>    
        CldIce<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>         
        CldIce<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>         
        CldIce<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>newl <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">8</span>  
    <span class="token keyword">else</span> <span class="token keyword">if</span> 
    ....
    <span class="token keyword">end if</span>
<span class="token keyword">end if</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>uncertain or FillValue （ik=5）</li></ul> <p>处理方式和混合态（ik=3）相同。</p> <ul><li><p>最后一种是晴空（ik=4）  <code>CldWtr=0 ,CldIce=0</code></p></li> <li><p>QC</p> <p>这里使用了一个qc，用来表示云类型</p> <table><thead><tr><th>qc</th> <th>1</th> <th>2</th> <th>3</th> <th>4</th> <th>0</th></tr></thead> <tbody><tr><td>说明</td> <td>液态水</td> <td>冰态水</td> <td>mixed</td> <td>uncertain</td> <td>晴空</td></tr></tbody></table> <p>由于云信息是区域平均的，所以每个亮温样本匹配的云可以不止一种相态，所以，不同的相态会分布在不同的高度，有着不同的水含量，这就是MWRT使用水凝物廓线的意义。虽然一朵云只能压缩在一层中，但是不同相态的云可以分布在不同的高度层上面。也就是说，有的亮温样本可能同时经历了上面的若干种处理方法，得到一条丰富的包含各个相态的水凝物廓线。这就是mixed类型和uncertain类型引起的。</p> <p>下面是云高定位和求算水凝物廓线的示意图：</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4ly510vfkj315v0hhq4c.jpg"></li></ul></li></ol> <hr> <h2 id="建议"><a href="#建议" class="header-anchor">#</a> - 建议</h2> <ul><li><p>如果重新做这套数据，建议使用res1云的EFOV平均尺寸为44=sqrt(piX25X25) km，所以用9X9格点就够了</p> <p>也就是:</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  <span class="token keyword">do</span> i <span class="token operator">=</span> icx<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span>icx<span class="token operator">+</span><span class="token number">4</span>
	     <span class="token keyword">do</span> j <span class="token operator">=</span> icy <span class="token operator">-</span><span class="token number">4</span> <span class="token punctuation">,</span>icy <span class="token operator">+</span><span class="token number">4</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>rainflag<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span> <span class="token operator">.gt.</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">cycle</span>		 
.....
      <span class="token keyword">end do</span>
   <span class="token keyword">end do</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <h2 id="附录"><a href="#附录" class="header-anchor">#</a> -附录</h2> <ul><li>MWSIM水凝物设置说明，来源于mwsim模式源代码<code>radsub.f</code></li></ul> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>C for hydrometeors<span class="token punctuation">,</span> always assume gamma psd<span class="token punctuation">,</span> i<span class="token operator">.e.</span><span class="token punctuation">,</span>
C   N<span class="token punctuation">(</span>D<span class="token punctuation">)</span> <span class="token operator">=</span> N0<span class="token operator">*</span>D<span class="token operator">**</span>mu<span class="token operator">*</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>lambda<span class="token operator">*</span>D<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">where</span> D is diameter <span class="token keyword">in</span> m<span class="token punctuation">,</span> and 
C          N<span class="token punctuation">(</span>D<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m^<span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">+</span>mu<span class="token punctuation">)</span>
C <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span> CAN <span class="token keyword">ONLY</span> GIVEN TWO of the THREE<span class="token punctuation">:</span> N0<span class="token punctuation">,</span> lambda and water content
C CldWtr<span class="token punctuation">:</span>						CldWtr<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span>
C  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> cloud liquid water content <span class="token punctuation">(</span>WC<span class="token punctuation">)</span> <span class="token keyword">in</span> g<span class="token operator">/</span>m^<span class="token number">3</span>
C  <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> N0 <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m^<span class="token number">4</span>
C  <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> Lambda <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m
C  <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> mu <span class="token keyword">in</span> psd <span class="token punctuation">(</span>mu<span class="token operator">=</span><span class="token number">0</span> is exponential<span class="token punctuation">)</span>
C  <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0</span><span class="token punctuation">:</span> no cloud water<span class="token punctuation">;</span> <span class="token number">1</span><span class="token punctuation">:</span> know N0 and WC<span class="token punctuation">;</span> 
C          <span class="token number">2</span><span class="token punctuation">:</span> know lambda and WC<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">:</span> know N0 and lambda
C          <span class="token number">4</span><span class="token punctuation">:</span> know N and WC for monosized cloud drops<span class="token punctuation">,</span> N0 will be N <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m^<span class="token number">3</span>
C          <span class="token number">5</span><span class="token punctuation">:</span> know D<span class="token punctuation">(</span>iameter<span class="token punctuation">,</span> <span class="token keyword">in</span> um<span class="token punctuation">)</span> and WC for monosized<span class="token punctuation">,</span> LAM will be D <span class="token keyword">in</span> um
C	   <span class="token number">6</span><span class="token punctuation">:</span> know N and D <span class="token punctuation">(</span><span class="token keyword">use</span> N0 and LAM<span class="token punctuation">)</span> for monosized cloud drops
C             N <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m^<span class="token number">3</span><span class="token punctuation">,</span> D <span class="token keyword">in</span> um
C   <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span> when giving D<span class="token punctuation">,</span> please <span class="token keyword">use</span> even number <span class="token punctuation">(</span>so that radius will be an <span class="token keyword">integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
C          otherwise<span class="token punctuation">,</span> it will be rounded to the nearest even number internally
C          <span class="token keyword">in</span> the <span class="token keyword">program</span>.   <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>


C CldIce<span class="token punctuation">:</span>						CldIce<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span>
C  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> cloud ice water content <span class="token punctuation">(</span>WC<span class="token punctuation">)</span> <span class="token keyword">in</span> g<span class="token operator">/</span>m^<span class="token number">3</span>
C  <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> N0 <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m^<span class="token number">4</span>
C  <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> Lambda <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m
C  <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> mu <span class="token keyword">in</span> psd <span class="token punctuation">(</span>mu<span class="token operator">=</span><span class="token number">0</span> is exponential<span class="token punctuation">)</span>
C  <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0</span><span class="token punctuation">:</span> no cloud ice water<span class="token punctuation">;</span> 
C          <span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span> D <span class="token keyword">in</span> PSD is melted diameter<span class="token punctuation">;</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">:</span> D <span class="token keyword">in</span> PSD is actual diameter
C          abs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span> know N0 and WC<span class="token punctuation">,</span> lambda will be output<span class="token punctuation">;</span> 
C          abs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span> know lambda and WC<span class="token punctuation">,</span> N0 will be output<span class="token punctuation">;</span> 
C          abs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">:</span> know N0 and lambda<span class="token punctuation">,</span> WC will be output
C          <span class="token number">4</span><span class="token punctuation">:</span> know N and WC for monosized cloud ice particles<span class="token punctuation">,</span> N0 will be N <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m^<span class="token number">3</span>
C          <span class="token number">5</span><span class="token punctuation">:</span> know D<span class="token punctuation">(</span>iameter<span class="token punctuation">,</span> <span class="token keyword">in</span> um<span class="token punctuation">)</span> and WC for monosized<span class="token punctuation">,</span> LAM will be D <span class="token keyword">in</span> um
C          <span class="token number">6</span><span class="token punctuation">:</span> know N and D <span class="token punctuation">(</span><span class="token keyword">use</span> N0 and LAM<span class="token punctuation">)</span> for monosized cloud ice particles
C             N <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span>m^<span class="token number">3</span><span class="token punctuation">,</span> D <span class="token keyword">in</span> um 
C     Note<span class="token punctuation">:</span> options <span class="token number">4</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> can <span class="token keyword">only</span> work for spheres
C  <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span> when giving D<span class="token punctuation">,</span> please <span class="token keyword">use</span> even number <span class="token punctuation">(</span>so that radius will be an <span class="token keyword">integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
C         otherwise<span class="token punctuation">,</span> it will be rounded to the nearest even number internally
C         <span class="token keyword">in</span> the <span class="token keyword">program</span>.   <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>
C  <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> ice shape or density <span class="token keyword">in</span> g<span class="token operator">/</span>cm^<span class="token number">3</span>
C          <span class="token keyword">if</span><span class="token operator">&gt;=</span><span class="token number">0</span> ice shape no <span class="token keyword">in</span> scatdb<span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token number">0</span> its absolute value is density
C          for monosized cloud ice particles<span class="token punctuation">,</span> must set <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span> <span class="token punctuation">(</span>spheres<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><hr> <p>©jihenghu 2019</p></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/jihenghu/jihenghu.github.io/edit/master/docs/document/mlse-ae/collocate.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/collocate.html#文件夹内容" class="sidebar-link" data-v-40a3448a>- 文件夹内容</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/collocate.html#运行方式" class="sidebar-link" data-v-40a3448a>- 运行方式</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/collocate.html#上游数据集" class="sidebar-link" data-v-40a3448a>- 上游数据集</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/collocate.html#输出说明" class="sidebar-link" data-v-40a3448a>- 输出说明</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/collocate.html#流程" class="sidebar-link" data-v-40a3448a>- 流程</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/collocate.html#建议" class="sidebar-link" data-v-40a3448a>- 建议</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/collocate.html#附录" class="sidebar-link" data-v-40a3448a>-附录</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.84efe3cb.js" defer></script><script src="/assets/js/3.a3aaa010.js" defer></script><script src="/assets/js/1.f6ff2096.js" defer></script><script src="/assets/js/23.d1a88016.js" defer></script>
  </body>
</html>
