<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AMSR-E L2A 数据预处理说明 | HERRERA21</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/logo_1.jpg">
    <meta name="description" content="Do not go gentle into that good night">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.b766760d.css" as="style"><link rel="preload" href="/assets/js/app.84efe3cb.js" as="script"><link rel="preload" href="/assets/js/3.a3aaa010.js" as="script"><link rel="preload" href="/assets/js/1.f6ff2096.js" as="script"><link rel="preload" href="/assets/js/21.3ee3a6e7.js" as="script"><link rel="prefetch" href="/assets/js/10.910481d9.js"><link rel="prefetch" href="/assets/js/11.93284723.js"><link rel="prefetch" href="/assets/js/12.e7736cc1.js"><link rel="prefetch" href="/assets/js/13.17355dd0.js"><link rel="prefetch" href="/assets/js/14.85884ad0.js"><link rel="prefetch" href="/assets/js/15.1bfd135b.js"><link rel="prefetch" href="/assets/js/16.1ec90c07.js"><link rel="prefetch" href="/assets/js/17.079f4d4c.js"><link rel="prefetch" href="/assets/js/18.7cb12f6d.js"><link rel="prefetch" href="/assets/js/19.94499731.js"><link rel="prefetch" href="/assets/js/20.7b1459b5.js"><link rel="prefetch" href="/assets/js/22.6e66727b.js"><link rel="prefetch" href="/assets/js/23.d1a88016.js"><link rel="prefetch" href="/assets/js/24.6805c447.js"><link rel="prefetch" href="/assets/js/25.672046e4.js"><link rel="prefetch" href="/assets/js/26.811ff7a8.js"><link rel="prefetch" href="/assets/js/27.602fcbf5.js"><link rel="prefetch" href="/assets/js/28.f3b6cf79.js"><link rel="prefetch" href="/assets/js/29.17eb6a32.js"><link rel="prefetch" href="/assets/js/30.348b5dc5.js"><link rel="prefetch" href="/assets/js/31.7c5b8704.js"><link rel="prefetch" href="/assets/js/32.23aa9611.js"><link rel="prefetch" href="/assets/js/33.7512e85b.js"><link rel="prefetch" href="/assets/js/34.1d9445c2.js"><link rel="prefetch" href="/assets/js/35.c268eff8.js"><link rel="prefetch" href="/assets/js/36.1e0f3a32.js"><link rel="prefetch" href="/assets/js/37.ee7e9551.js"><link rel="prefetch" href="/assets/js/38.8fc26356.js"><link rel="prefetch" href="/assets/js/39.376bc501.js"><link rel="prefetch" href="/assets/js/4.3c60d52f.js"><link rel="prefetch" href="/assets/js/40.79ec5ca8.js"><link rel="prefetch" href="/assets/js/41.b6826f81.js"><link rel="prefetch" href="/assets/js/42.8edec565.js"><link rel="prefetch" href="/assets/js/43.75e1b398.js"><link rel="prefetch" href="/assets/js/44.606048d9.js"><link rel="prefetch" href="/assets/js/45.52cc7a17.js"><link rel="prefetch" href="/assets/js/46.035206fe.js"><link rel="prefetch" href="/assets/js/47.af896726.js"><link rel="prefetch" href="/assets/js/48.b6ea32e9.js"><link rel="prefetch" href="/assets/js/49.8c4101b3.js"><link rel="prefetch" href="/assets/js/5.fdb8e8f3.js"><link rel="prefetch" href="/assets/js/50.fa471f22.js"><link rel="prefetch" href="/assets/js/51.4b829392.js"><link rel="prefetch" href="/assets/js/52.c6b64162.js"><link rel="prefetch" href="/assets/js/53.74ea9152.js"><link rel="prefetch" href="/assets/js/54.a705698b.js"><link rel="prefetch" href="/assets/js/55.5b6e8824.js"><link rel="prefetch" href="/assets/js/56.f502c686.js"><link rel="prefetch" href="/assets/js/57.64acd402.js"><link rel="prefetch" href="/assets/js/58.13178010.js"><link rel="prefetch" href="/assets/js/59.7c77b928.js"><link rel="prefetch" href="/assets/js/6.b3240ba5.js"><link rel="prefetch" href="/assets/js/60.eb58b247.js"><link rel="prefetch" href="/assets/js/61.da17a9ec.js"><link rel="prefetch" href="/assets/js/62.01a37a3c.js"><link rel="prefetch" href="/assets/js/63.242e8fb8.js"><link rel="prefetch" href="/assets/js/64.57ecb7c4.js"><link rel="prefetch" href="/assets/js/65.963a41ea.js"><link rel="prefetch" href="/assets/js/66.c4d00490.js"><link rel="prefetch" href="/assets/js/67.c91612ef.js"><link rel="prefetch" href="/assets/js/68.b34c0e86.js"><link rel="prefetch" href="/assets/js/69.55ba8c4c.js"><link rel="prefetch" href="/assets/js/7.f8982902.js"><link rel="prefetch" href="/assets/js/70.fccbe541.js"><link rel="prefetch" href="/assets/js/71.ff487847.js"><link rel="prefetch" href="/assets/js/72.a3bac733.js"><link rel="prefetch" href="/assets/js/73.2051552a.js"><link rel="prefetch" href="/assets/js/74.36d4b632.js"><link rel="prefetch" href="/assets/js/75.f7d15781.js"><link rel="prefetch" href="/assets/js/76.98571538.js"><link rel="prefetch" href="/assets/js/77.cd5b3b29.js"><link rel="prefetch" href="/assets/js/8.92693fd7.js"><link rel="prefetch" href="/assets/js/9.2c2ca473.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b766760d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>HERRERA21</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>HERRERA21</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_1.jpg" alt="HERRERA21" class="logo"> <span class="site-name">HERRERA21</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/科研/" class="nav-link"><i class="iconfont undefined"></i>
  科研
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active"><i class="iconfont reco-suggestion"></i>
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Projects🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>Notes🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learnote/" class="nav-link"><i class="iconfont undefined"></i>
  Learning notes
</a></li></ul></li><li class="dropdown-item"><h4>协同分析平台🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mpcaplas/" class="nav-link"><i class="iconfont undefined"></i>
  协同分析平台
</a></li><li class="dropdown-subitem"><a href="/mpcaplas/dataset/" class="nav-link"><i class="iconfont undefined"></i>
  后台数据集说明文档
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-message"></i>
  关于
</a></div> <a href="https://github.com/jihenghu/jihenghu.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/logo_1.jpg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    HERRERA21
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>7</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>6</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/科研/" class="nav-link"><i class="iconfont undefined"></i>
  科研
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active"><i class="iconfont reco-suggestion"></i>
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Projects🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>Notes🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learnote/" class="nav-link"><i class="iconfont undefined"></i>
  Learning notes
</a></li></ul></li><li class="dropdown-item"><h4>协同分析平台🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mpcaplas/" class="nav-link"><i class="iconfont undefined"></i>
  协同分析平台
</a></li><li class="dropdown-subitem"><a href="/mpcaplas/dataset/" class="nav-link"><i class="iconfont undefined"></i>
  后台数据集说明文档
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-message"></i>
  关于
</a></div> <a href="https://github.com/jihenghu/jihenghu.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <ul class="sidebar-links"><li><a href="/document/" aria-current="page" class="sidebar-link">文档概览</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>AMSR-E MLSE反演文档</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/mlse-ae/prefix.html" class="sidebar-link">MLSE 中国 version2 说明文档 - 前言</a></li><li><a href="/document/mlse-ae/2a.html" aria-current="page" class="active sidebar-link">AMSR-E L2A 数据预处理说明</a></li><li><a href="/document/mlse-ae/2b.html" class="sidebar-link">AMSR-E L2B 数据预处理说明</a></li><li><a href="/document/mlse-ae/06.html" class="sidebar-link">MYD06 L2 数据预处理说明</a></li><li><a href="/document/mlse-ae/20c.html" class="sidebar-link">ERA-20C 数据预处理说明</a></li><li><a href="/document/mlse-ae/collocate.html" class="sidebar-link">Res1 融合(Collocation)处理说明</a></li><li><a href="/document/mlse-ae/retrieve.html" class="sidebar-link">反演说明</a></li><li><a href="/document/mlse-ae/res3.html" class="sidebar-link">Res3 MLSE反演说明</a></li><li><a href="/document/mlse-ae/misc.html" class="sidebar-link">后期处理说明</a></li><li><a href="/document/mlse-ae/mwsim.html" class="sidebar-link">MWRT模式的安装和使用说明</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GMI MLSE反演文档</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>AMSR-E L2A 数据预处理说明</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>HERRERA21</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>AMSR-E L2A 数据预处理说明</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>HERRERA21</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2019-06-24</span></i> <i class="iconfont reco-eye" data-v-aa64b9d0><span id="/document/mlse-ae/2a.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-aa64b9d0><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><p></p><div class="table-of-contents"><ul><li><a href="#文件夹内容">- 文件夹内容</a></li><li><a href="#运行方式">- 运行方式</a></li><li><a href="#preprocess-2a-ncl">- preprocess.2a.ncl</a></li><li><a href="#ascii2d-writeout-f">- ascii2d_writeout.f</a></li><li><a href="#数据说明">- 数据说明</a></li><li><a href="#建议和问题">- 建议和问题</a></li><li><a href="#附录">附录</a></li></ul></div><p></p> <h2 id="文件夹内容"><a href="#文件夹内容" class="header-anchor">#</a> - 文件夹内容</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>+data  <span class="token comment">#存储处理过的2A数据，txt格式</span>
- preprocess.2a.ncl  <span class="token comment">#主要的处理程序，NCL语言编写</span>
- ascii2d_writeout.f  <span class="token comment">#使用fortran77 编写的NCL子程序，用于格式化输出</span>
- ascii2d_writeout.so  <span class="token comment">#使用WRAPIT生成的动态库文件，preprocess.2a.ncl会引用此动态库进行格式化输出</span>
- batch.sh  <span class="token comment">#批量控制脚本，shell语法，用于对大批量的日期进行操作</span>
- show.amsre.scantime.ncl <span class="token comment">#单轨轨道示意图代码（不是主要代码）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><hr> <h2 id="运行方式"><a href="#运行方式" class="header-anchor">#</a> - 运行方式</h2> <ul><li><p>单个日期处理（如2004年1月1日)</p> <p>NCL带参运行 yyyymmdd=20040101</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$ncl</span> <span class="token assign-left variable">yyyymmdd</span><span class="token operator">=</span><span class="token number">20040101</span> preprocess.2a.ncl 
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	yyyymmdd:20040101
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	hdf files: <span class="token number">6</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	Done with <span class="token number">20040101</span>-------------------------
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>运行结果：data文件夹下出现<code>AEL2A.masked.TB.res1.20040101.txt</code>，任务完成。</p></li> <li><p>批量日期处理（如20040102~20040103）</p> <p>使用<code>batch.sh</code>脚本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$sh</span> batch.sh <span class="token number">20040102</span> <span class="token number">20040103</span>
<span class="token number">20040102</span>                                              <span class="token comment">#batch.sh 输出信息</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	yyyymmdd:20040102                                 <span class="token comment">#NCL脚本输出信息</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	hdf files: <span class="token number">6</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	Done with <span class="token number">20040102</span>-------------------------
<span class="token number">20040103</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	yyyymmdd:20040103
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	hdf files: <span class="token number">6</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>	Done with <span class="token number">20040103</span>-------------------------

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>运行结果：data文件夹下出现</p> <p><code>AEL2A.masked.TB.res1.20040102.txt</code></p> <p><code>AEL2A.masked.TB.res1.20040103.txt</code></p> <p>对于批量来说，为了发挥机器资源，建议没半年或一年一个批量，这一部分的处理速度还是很快的。</p> <p>也可以放在后台运行，不过这部分数据处理速度较快，一般不需要放进后台：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$nohup</span> <span class="token function">sh</span> batch.sh <span class="token number">20040102</span> <span class="token number">20040103</span> <span class="token operator">&gt;</span> log.20040102-20040103 <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <hr> <h2 id="preprocess-2a-ncl"><a href="#preprocess-2a-ncl" class="header-anchor">#</a> - <code>preprocess.2a.ncl</code></h2> <ul><li><p>根据ROI (Region of Interest)裁剪轨道:</p> <div class="language-NCL line-numbers-mode"><pre class="language-text"><code>;;;获得轨道的四至点行列下标
ji = region_ind(Latitude_Low_Res_2d,Longitude_Low_Res_2d, latS, latN, lonW, lonE)  
            jStrt = ji(0)      ; lat start
            jLast = ji(1)      ; lat last
            iStrt = ji(2)      ; lon start
            iLast = ji(3)      ; lon last
LAT2D = Latitude_Low_Res_2d(jStrt:jLast,iStrt:iLast)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用函数<code>region_ind</code>和ROI的四至来计算<code>ji</code>,是一个四元数组，和图1中的对应关系是：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>jStrt =&gt; minScan
jLast =&gt; maxScan
iStrt =&gt; minCol
iLast =&gt; maxCol
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用<code>(jStrt:jLast,iStrt:iLast)</code>下标范围确定的区域即为图1中的阴影区域，并且这几个轨道的阴影区是相连的（上行轨道最右侧的轨道是最早过境的，左边的过境稍晚）。轨道的其他部分被裁剪掉，</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4fot8ifoij30j70dpwfd.jpg" style="width:500px;height:300px;"></li></ul> <p style="text-align:center;">图1. 使用ji剪裁出的轨道</p> <p>使用经纬度确定好下标范围以后，提取其他参数直接按下标提取需要的部分，节省内存开销，如：</p> <div class="language-NCL line-numbers-mode"><pre class="language-text"><code>time0  = hdfile[:]-&gt;Time_Low_Res_Swath(jStrt:jLast) 	
 landoceanres=hdfile[:]-&gt;Land_Ocean_Flag(jStrt:jLast,iStrt:iLast,0) 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>进一步地，对ROI外的样本进行缺测：</p> <div class="language-NCL line-numbers-mode"><pre class="language-text"><code>landocean = where(LAT2D .lt. latS .or. \
	                 LAT2D .gt. latN .or. \
	                 LON2D .lt. lonW .or. \
	                 LON2D .gt. lonE ,fillvalue ,landocean)	 
landocean@_FillValue = fillvalue	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>后期在输出时判断是否为缺测即可仅仅保留ROI内的观测样本。效果如图2：</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4fpoi9qh2j30m60g60tv.jpg" style="width:500px;height:300px;"> <p style="text-align:center;">图2. 进一步去除不需要的ROI外样本</p> <p>看看实际效果加强理解:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$ncl</span> <span class="token assign-left variable">yyyymmdd</span><span class="token operator">=</span><span class="token number">20040101</span> show.amsre.scantime.ncl 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><img src="https://ws1.sinaimg.cn/large/005zDzHply1g4fuk3z5fpj30nx0grq5s.jpg" style="width:500px;height:300px;"> <p style="text-align:center;">图3.实际的轨道剪切和缺测情况，单轨</p> <p>可以看出轨道剪切的范围在ROI之外，但是外部已经被缺测了，这部分不会输出。</p> <hr> <h2 id="ascii2d-writeout-f"><a href="#ascii2d-writeout-f" class="header-anchor">#</a> - <code>ascii2d_writeout.f</code></h2> <ul><li><p>使用F77编写的NCL子程序，使用<strong>WRAPT</strong>打包成动态库 <code>ascii2d_writeout.so</code>，详见<a href="http://www.ncl.ucar.edu/Document/Tools/WRAPIT.shtml" target="_blank" rel="noopener noreferrer">NCL-WRAPIT<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>主要是使用 NCLFORTSTART语句包装F77子程序的函数名和声明部分，</p> <div class="language-fortran 77 line-numbers-mode"><pre class="language-fortran"><code>C       NCLFORTSTART
        <span class="token keyword">subroutine</span> ascii2d_writeout<span class="token punctuation">(</span>dims<span class="token punctuation">,</span>....<span class="token punctuation">)</span>		
         <span class="token keyword">integer</span> dims <span class="token punctuation">,</span>...
C       NCLEND
         <span class="token keyword">print</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token string">&quot;Hello World!!!&quot;</span>
        <span class="token keyword">END</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>还用WRAPIT命令打包成动态库<code>.so</code>文件：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$WRAPIT</span> ascii2d_writeout.f
WRAPIT Version: <span class="token number">120209</span>
COMPILING ascii2d_writeout.f
LINKING
END WRAPIT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>成功，当前目录出现，<code>ascii2d_writeout.so</code>文件。</p></li> <li><p>NCL调用，<code>preprocess.2a.ncl</code>中</p> <div class="language-NCL line-numbers-mode"><pre class="language-text"><code>external SUB &quot;./ascii2d_writeout.so&quot;   ;;;头部引入
begin
.....
SUB::ascii2d_writeout(dims,....)       ;;;CALL F77 subroutine 格式要和声明一直
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><strong>注意！！！每次修改完ascii2d_writeout.f文件要重新打包成<code>.so</code>否则不生效。</strong></p></li></ul> <hr> <h2 id="数据说明"><a href="#数据说明" class="header-anchor">#</a> - 数据说明</h2> <ul><li><p>对于AE-L2A的处理，最终输出的数据特征有：</p> <ul><li><p>包含全部land_ocean_flag 大于80%的样本，后来证明陆地要求至少98%，后期做了筛选。不过陆地比例范围发也是有利用价值的。</p></li> <li><p>包含Aqua的上行轨道样本，过境时间一般在当地时14:00左右，具体以ScanTime为准。</p></li> <li><p>卫星的地面入射角为52.8度。</p></li> <li><p>亮温通道顺序为：（v 垂直极化；h水平极化 ； 单位GHz）</p> <div class="language-normal line-numbers-mode"><pre class="language-text"><code>&quot;6.9v&quot;,&quot;6.9h&quot;,&quot;10.7v&quot;,&quot;10.7h&quot;,&quot;18.7v&quot;,&quot;18.7h&quot;,&quot;23.8v&quot;,&quot;23.8h&quot;,&quot;36.5v&quot;,&quot;36.5h&quot;,&quot;89.0v&quot;,&quot;89.0h&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>输出参数包含样本序号，经纬度，扫描时间，陆地分数，12通道亮温等，详见表1。</p> <p><strong>表1. 输出参数详情</strong></p> <table><thead><tr><th style="text-align:center;">参数</th> <th style="text-align:center;">ip</th> <th style="text-align:center;">lon</th> <th style="text-align:center;">lat</th> <th style="text-align:center;">TBs</th> <th style="text-align:center;">scanTime</th> <th style="text-align:center;">landFlag</th></tr></thead> <tbody><tr><td style="text-align:center;">说明</td> <td style="text-align:center;">序号</td> <td style="text-align:center;">经度</td> <td style="text-align:center;">纬度</td> <td style="text-align:center;">12通道亮温</td> <td style="text-align:center;">扫描时间</td> <td style="text-align:center;">陆地分数</td></tr> <tr><td style="text-align:center;">有效范围</td> <td style="text-align:center;">自然数</td> <td style="text-align:center;">70-145</td> <td style="text-align:center;">10-55</td> <td style="text-align:center;">100K-300 K</td> <td style="text-align:center;">UTC时间（单位小时）</td> <td style="text-align:center;">0-100</td></tr> <tr><td style="text-align:center;">输出类型</td> <td style="text-align:center;">I6</td> <td style="text-align:center;">F12.6</td> <td style="text-align:center;">F12.6</td> <td style="text-align:center;">12F12.6</td> <td style="text-align:center;">F12.6</td> <td style="text-align:center;">F12.6</td></tr></tbody></table></li> <li><p>输出文件示例：</p> <p><code>AEL2A.masked.TB.res1.20040101.txt</code>，格式化ascii文件。</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>    22  143.824844   49.743305  251.199997  236.269989  250.589996  237.440002  249.099991  236.299988  248.380005  236.319992  243.739990  232.899994  233.130005  225.910004    2.666667   95.000000
    
    23  143.784378   49.665657  251.119995  236.519989  250.319992  237.169998  248.579987  235.720001  247.549988  235.559998  242.039993  231.369995  229.410004  222.410004    2.666667  100.000000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>ascii2d_writeout.f</code>中以上参数按序输出：</p> <div class="language-fortran 77 line-numbers-mode"><pre class="language-fortran"><code>          <span class="token keyword">write</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span> ip<span class="token punctuation">,</span>lon1d<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>lat1d<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>tbs1d<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">+</span>               Time_1D<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> landflag1d<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
 <span class="token number">100</span>      <span class="token keyword">format</span><span class="token punctuation">(</span>I6<span class="token punctuation">,</span><span class="token number">20</span>F12.<span class="token number">6</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ul> <hr> <h2 id="建议和问题"><a href="#建议和问题" class="header-anchor">#</a> - 建议和问题</h2> <ul><li>每次按照需求改定代码是，最好在格式化输出之前输出成NetCDF文件或者画图check一下样本筛选是否符合心理预期，检查数据时候正常。反复检查和后续回头检查都是好习惯，途径就是画图诊断。注意，在画图check的时候不要给地图填色，可以看到海洋，湖泊是否有样本。</li> <li>为什么输出成ascii文件而不是别的？这主要是方便检查每一个样本的各个参数是否有问题，在后续的处理中经常会遇到需要检查经纬度是否在区域内或者边缘；检查数值大小，分布情况是否合理，都有助于debug。但是输出成NC文件不利于后续使用fortran代码读取，输出成二进制是一个好办法，对于三维参数输出使用这种方案，但是不直观。这是沿袭李老师最开始的风格。</li> <li>为何使用fortran子程序去写出数据，这么麻烦？因为fortran的格式化输出很快，而且友好。当然你也可以使用NCL自带的<code>write_table</code>函数来循环读写，但是有点慢，<code>write_table</code>是唯一一个可以往已存在文件尾部add数据记录的ascii写函数。</li> <li>为什么要做轨道的剪切？因为动辄6，7条全球轨道拼在一起很吃内存，甚至有时候会segment fault，这样剪切以后就是小数组，操作也快很多，下标操作很快的。</li></ul> <hr> <h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <ul><li><p>batch.sh</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">first</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">second</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$first</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;<span class="token variable">$second</span>&quot;</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$first</span>
    ncl -Q <span class="token assign-left variable">yyyymmdd</span><span class="token operator">=</span><span class="token variable">${first}</span> preprocess.2a.ncl
    <span class="token builtin class-name">let</span> <span class="token assign-left variable">first</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">&quot;-1 days ago <span class="token variable">${first}</span>&quot;</span> +%Y%m%d<span class="token variable">`</span></span>
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$second</span>
ncl -Q <span class="token assign-left variable">yyyymmdd</span><span class="token operator">=</span><span class="token variable">${second}</span>  preprocess.2a.ncl
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>AE-L2A全球扫描时间</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4fpjkmgvuj30r40go7cu.jpg" style="width:500px;height:300px;"></li> <li><p>中国地区Scantime</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4fpkiwhrjj30p20hun1m.jpg" style="width:500px;height:300px;"></li> <li><p>亮温</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4fpm27956j30sg0sg7ms.jpg" style="width:500px;height:500px;"></li></ul> <p>© Jihenghu 2019</p></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/jihenghu/jihenghu.github.io/edit/master/docs/document/mlse-ae/2a.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/2a.html#文件夹内容" class="sidebar-link" data-v-40a3448a>- 文件夹内容</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/2a.html#运行方式" class="sidebar-link" data-v-40a3448a>- 运行方式</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/2a.html#preprocess-2a-ncl" class="sidebar-link" data-v-40a3448a>- preprocess.2a.ncl</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/2a.html#ascii2d-writeout-f" class="sidebar-link" data-v-40a3448a>- ascii2d_writeout.f</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/2a.html#数据说明" class="sidebar-link" data-v-40a3448a>- 数据说明</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/2a.html#建议和问题" class="sidebar-link" data-v-40a3448a>- 建议和问题</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/2a.html#附录" class="sidebar-link" data-v-40a3448a>附录</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.84efe3cb.js" defer></script><script src="/assets/js/3.a3aaa010.js" defer></script><script src="/assets/js/1.f6ff2096.js" defer></script><script src="/assets/js/21.3ee3a6e7.js" defer></script>
  </body>
</html>
