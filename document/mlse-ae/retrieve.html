<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>反演说明 | HERRERA21</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/logo_1.jpg">
    <meta name="description" content="Do not go gentle into that good night">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.b766760d.css" as="style"><link rel="preload" href="/assets/js/app.84efe3cb.js" as="script"><link rel="preload" href="/assets/js/3.a3aaa010.js" as="script"><link rel="preload" href="/assets/js/1.f6ff2096.js" as="script"><link rel="preload" href="/assets/js/28.f3b6cf79.js" as="script"><link rel="prefetch" href="/assets/js/10.910481d9.js"><link rel="prefetch" href="/assets/js/11.93284723.js"><link rel="prefetch" href="/assets/js/12.e7736cc1.js"><link rel="prefetch" href="/assets/js/13.17355dd0.js"><link rel="prefetch" href="/assets/js/14.85884ad0.js"><link rel="prefetch" href="/assets/js/15.1bfd135b.js"><link rel="prefetch" href="/assets/js/16.1ec90c07.js"><link rel="prefetch" href="/assets/js/17.079f4d4c.js"><link rel="prefetch" href="/assets/js/18.7cb12f6d.js"><link rel="prefetch" href="/assets/js/19.94499731.js"><link rel="prefetch" href="/assets/js/20.7b1459b5.js"><link rel="prefetch" href="/assets/js/21.3ee3a6e7.js"><link rel="prefetch" href="/assets/js/22.6e66727b.js"><link rel="prefetch" href="/assets/js/23.d1a88016.js"><link rel="prefetch" href="/assets/js/24.6805c447.js"><link rel="prefetch" href="/assets/js/25.672046e4.js"><link rel="prefetch" href="/assets/js/26.811ff7a8.js"><link rel="prefetch" href="/assets/js/27.602fcbf5.js"><link rel="prefetch" href="/assets/js/29.17eb6a32.js"><link rel="prefetch" href="/assets/js/30.348b5dc5.js"><link rel="prefetch" href="/assets/js/31.7c5b8704.js"><link rel="prefetch" href="/assets/js/32.23aa9611.js"><link rel="prefetch" href="/assets/js/33.7512e85b.js"><link rel="prefetch" href="/assets/js/34.1d9445c2.js"><link rel="prefetch" href="/assets/js/35.c268eff8.js"><link rel="prefetch" href="/assets/js/36.1e0f3a32.js"><link rel="prefetch" href="/assets/js/37.ee7e9551.js"><link rel="prefetch" href="/assets/js/38.8fc26356.js"><link rel="prefetch" href="/assets/js/39.376bc501.js"><link rel="prefetch" href="/assets/js/4.3c60d52f.js"><link rel="prefetch" href="/assets/js/40.79ec5ca8.js"><link rel="prefetch" href="/assets/js/41.b6826f81.js"><link rel="prefetch" href="/assets/js/42.8edec565.js"><link rel="prefetch" href="/assets/js/43.75e1b398.js"><link rel="prefetch" href="/assets/js/44.606048d9.js"><link rel="prefetch" href="/assets/js/45.52cc7a17.js"><link rel="prefetch" href="/assets/js/46.035206fe.js"><link rel="prefetch" href="/assets/js/47.af896726.js"><link rel="prefetch" href="/assets/js/48.b6ea32e9.js"><link rel="prefetch" href="/assets/js/49.8c4101b3.js"><link rel="prefetch" href="/assets/js/5.fdb8e8f3.js"><link rel="prefetch" href="/assets/js/50.fa471f22.js"><link rel="prefetch" href="/assets/js/51.4b829392.js"><link rel="prefetch" href="/assets/js/52.c6b64162.js"><link rel="prefetch" href="/assets/js/53.74ea9152.js"><link rel="prefetch" href="/assets/js/54.a705698b.js"><link rel="prefetch" href="/assets/js/55.5b6e8824.js"><link rel="prefetch" href="/assets/js/56.f502c686.js"><link rel="prefetch" href="/assets/js/57.64acd402.js"><link rel="prefetch" href="/assets/js/58.13178010.js"><link rel="prefetch" href="/assets/js/59.7c77b928.js"><link rel="prefetch" href="/assets/js/6.b3240ba5.js"><link rel="prefetch" href="/assets/js/60.eb58b247.js"><link rel="prefetch" href="/assets/js/61.da17a9ec.js"><link rel="prefetch" href="/assets/js/62.01a37a3c.js"><link rel="prefetch" href="/assets/js/63.242e8fb8.js"><link rel="prefetch" href="/assets/js/64.57ecb7c4.js"><link rel="prefetch" href="/assets/js/65.963a41ea.js"><link rel="prefetch" href="/assets/js/66.c4d00490.js"><link rel="prefetch" href="/assets/js/67.c91612ef.js"><link rel="prefetch" href="/assets/js/68.b34c0e86.js"><link rel="prefetch" href="/assets/js/69.55ba8c4c.js"><link rel="prefetch" href="/assets/js/7.f8982902.js"><link rel="prefetch" href="/assets/js/70.fccbe541.js"><link rel="prefetch" href="/assets/js/71.ff487847.js"><link rel="prefetch" href="/assets/js/72.a3bac733.js"><link rel="prefetch" href="/assets/js/73.2051552a.js"><link rel="prefetch" href="/assets/js/74.36d4b632.js"><link rel="prefetch" href="/assets/js/75.f7d15781.js"><link rel="prefetch" href="/assets/js/76.98571538.js"><link rel="prefetch" href="/assets/js/77.cd5b3b29.js"><link rel="prefetch" href="/assets/js/8.92693fd7.js"><link rel="prefetch" href="/assets/js/9.2c2ca473.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b766760d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>HERRERA21</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>HERRERA21</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_1.jpg" alt="HERRERA21" class="logo"> <span class="site-name">HERRERA21</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/科研/" class="nav-link"><i class="iconfont undefined"></i>
  科研
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active"><i class="iconfont reco-suggestion"></i>
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Projects🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>Notes🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learnote/" class="nav-link"><i class="iconfont undefined"></i>
  Learning notes
</a></li></ul></li><li class="dropdown-item"><h4>协同分析平台🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mpcaplas/" class="nav-link"><i class="iconfont undefined"></i>
  协同分析平台
</a></li><li class="dropdown-subitem"><a href="/mpcaplas/dataset/" class="nav-link"><i class="iconfont undefined"></i>
  后台数据集说明文档
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-message"></i>
  关于
</a></div> <a href="https://github.com/jihenghu/jihenghu.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/logo_1.jpg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    HERRERA21
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>7</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>6</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/科研/" class="nav-link"><i class="iconfont undefined"></i>
  科研
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active"><i class="iconfont reco-suggestion"></i>
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Projects🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  My Project
</a></li></ul></li><li class="dropdown-item"><h4>Notes🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learnote/" class="nav-link"><i class="iconfont undefined"></i>
  Learning notes
</a></li></ul></li><li class="dropdown-item"><h4>协同分析平台🎈</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mpcaplas/" class="nav-link"><i class="iconfont undefined"></i>
  协同分析平台
</a></li><li class="dropdown-subitem"><a href="/mpcaplas/dataset/" class="nav-link"><i class="iconfont undefined"></i>
  后台数据集说明文档
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-message"></i>
  关于
</a></div> <a href="https://github.com/jihenghu/jihenghu.github.io" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <ul class="sidebar-links"><li><a href="/document/" aria-current="page" class="sidebar-link">文档概览</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>AMSR-E MLSE反演文档</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/mlse-ae/prefix.html" class="sidebar-link">MLSE 中国 version2 说明文档 - 前言</a></li><li><a href="/document/mlse-ae/2a.html" class="sidebar-link">AMSR-E L2A 数据预处理说明</a></li><li><a href="/document/mlse-ae/2b.html" class="sidebar-link">AMSR-E L2B 数据预处理说明</a></li><li><a href="/document/mlse-ae/06.html" class="sidebar-link">MYD06 L2 数据预处理说明</a></li><li><a href="/document/mlse-ae/20c.html" class="sidebar-link">ERA-20C 数据预处理说明</a></li><li><a href="/document/mlse-ae/collocate.html" class="sidebar-link">Res1 融合(Collocation)处理说明</a></li><li><a href="/document/mlse-ae/retrieve.html" aria-current="page" class="active sidebar-link">反演说明</a></li><li><a href="/document/mlse-ae/res3.html" class="sidebar-link">Res3 MLSE反演说明</a></li><li><a href="/document/mlse-ae/misc.html" class="sidebar-link">后期处理说明</a></li><li><a href="/document/mlse-ae/mwsim.html" class="sidebar-link">MWRT模式的安装和使用说明</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GMI MLSE反演文档</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>反演说明</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>HERRERA21</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>反演说明</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>HERRERA21</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2019-06-29</span></i> <i class="iconfont reco-eye" data-v-aa64b9d0><span id="/document/mlse-ae/retrieve.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-aa64b9d0><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><p></p><div class="table-of-contents"><ul><li><a href="#内容">- 内容</a></li><li><a href="#运行方式">- 运行方式</a></li><li><a href="#读取上游数据">- 读取上游数据</a></li><li><a href="#调用反演子程序">- 调用反演子程序</a></li><li><a href="#迭代反演">-迭代反演</a></li><li><a href="#迭代参数设置">- 迭代参数设置</a></li><li><a href="#数据说明">- 数据说明</a><ul><li><a href="#利用fortran读取">利用fortran读取</a></li><li><a href="#利用ncl读取">利用NCL读取</a></li></ul></li><li><a href="#附录">附录</a></li><li><a href="#p-style-text-align-center-amsr-e-反演得到的-mlse-空间分布。个例时间：-2008-年-4-月-26-日。上中下：垂直极化通道，水平极化通道和对应频率的极化差。从左往右：-6-925、-10-65、-18-7、-23-8-和36-5-ghz-p"><p style="text-align:center;"> AMSR-E 反演得到的 MLSE 空间分布。个例时间： 2008 年 4 月 26 日。上中下：垂直极化通道，水平极化通道和对应频率的极化差。从左往右： 6.925、 10.65、 18.7、 23.8 和
36.5 GHz </p></a></li></ul></div><p></p> <p>在经历之前一系列的预处理和融合过程，我们现在终于可以使用辐射传输模式来反演MLSE了。</p> <p>在此之前，你要去学会安装MWRT模式和最新的MWSIM模式。学习其参数说明和设置，理解源代码的架构和模块。前往MWRT模式安装与使用章节。</p> <p>所谓反演，就是反向运转MWRT模式，使用天顶亮温反推到地表亮温的过程。因为辐射是从地表发射到天顶被卫星接收的，先在利用卫星的接收来反推到地表，就是这么个过程。</p> <h2 id="内容"><a href="#内容" class="header-anchor">#</a> - 内容</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>+ data              <span class="token comment">##存储反演最终结果</span>
- retrieve.f        <span class="token comment">##主反演程序 F77</span>
- core-iteration.f  <span class="token comment">##核心反演程序，迭代和调用MWRT模式</span>
- bash.sh             <span class="token comment">##编译retrieve.f 脚本</span>
- produce.mlse.exe     <span class="token comment">##编译产生的可执行文件</span>
- batch.sh             <span class="token comment">##批量化脚本</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><hr> <h2 id="运行方式"><a href="#运行方式" class="header-anchor">#</a> - 运行方式</h2> <ul><li><p>首先进行编译，需要用到MWRT的库函数，如<code>bash.sh</code>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>f95 retrieve.f /home/hjh/mwsim/src/rdcmd.c -L /home/hjh/mwsim/lib/ -lrad -lmwrt -llap -o produce.mlse.exe
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行脚本：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$sh</span> bash.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>产生可执行文件<code>produce.mlse.exe</code></p> <p><code>/home/hjh/mwsim/src/rdcmd.c -L /home/hjh/mwsim/lib/-lrad -lmwrt -llap</code> 是连接到MWRT的安装目录的，需要根据自己安装情况修改。</p></li> <li><p>单个日期处理（如2004年1月1日)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$./produce.mlse.exe <span class="token number">20040101</span>
 start
 <span class="token number">20040101</span>
 ael2a.ael2b.myd06.era20c.basic.20040101.txt                   <span class="token function">open</span>
 ael2a.ael2b.myd06.era20c.profile.20040101.txt                 <span class="token function">open</span>
 ael2a.ael2b.myd06.era20c.hydro.20040101.txt                   <span class="token function">open</span>
 <span class="token builtin class-name">read</span> <span class="token keyword">done</span> <span class="token number">20040101</span>
 <span class="token function">write</span> down <span class="token number">20040101</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>运行结果：data文件夹下出现<code>mlse.easia.amsre.modis.era.res1.001.20040101.txt</code>，任务完成。</p> <p>这个过程运行较慢，大概8个小时到10个小时。</p></li> <li><p>批量日期处理（如20040102~20040103）</p> <p>使用<code>batch.sh</code>脚本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$sh</span> batch.sh <span class="token number">20040102</span> <span class="token number">20040103</span>
<span class="token number">20040102</span>
<span class="token number">20040103</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>运行结果：执行日志会出现在同目录下：<code>20040102-20040103.log</code></p> <p>data文件夹下出现</p> <p><code>mlse.easia.amsre.modis.era.res1.001.20040102.txt</code></p> <p><code>mlse.easia.amsre.modis.era.res1.001.20040103.txt</code></p> <p>对于批量来说，建议一个月分段跑一个，处理一个月在12-14天左右（0.001精度要求下）。所以建议你后台运行：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token variable">$nohup</span> <span class="token function">sh</span> batch.sh <span class="token number">20040102</span> <span class="token number">20040103</span> <span class="token operator">&gt;</span> log.200401 <span class="token operator">&amp;</span>
<span class="token variable">$jobs</span> -l
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+ <span class="token number">15669</span> Running          <span class="token function">nohup</span> <span class="token function">sh</span> batch.sh <span class="token number">20040102</span> <span class="token number">20040103</span> <span class="token operator">&gt;</span> log.200401 <span class="token operator">&amp;</span>

<span class="token comment">##注意检查日志，运行是否正常。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <hr> <h2 id="读取上游数据"><a href="#读取上游数据" class="header-anchor">#</a> - 读取上游数据</h2> <p>来自<code>collocate.res1/data</code>文件夹下的:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>- ael2a.ael2b.myd06.era20c.basic.20040101.txt   <span class="token comment">##基本参数</span>
- ael2a.ael2b.myd06.era20c.profile.20040101.txt  <span class="token comment">##大气廓线</span>
- ael2a.ael2b.myd06.era20c.hydro.20040101.txt    <span class="token comment">##水凝物廓线   </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>读取这些数据采用的是将所有的观测样本一次性读取完毕存储在数组中，之后对数组进行循环反演各个点的MLSE，避免频繁的读写阻塞并发进程。</p> <p>如设置的大数组如下，部分参数：</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  <span class="token keyword">real</span><span class="token operator">*</span><span class="token number">4</span> lon<span class="token punctuation">(</span><span class="token number">170000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lat<span class="token punctuation">(</span><span class="token number">170000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tb<span class="token punctuation">(</span><span class="token number">170000</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>stime<span class="token punctuation">(</span><span class="token number">170000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于每天的样本数（文件行数）不固定，所以去最大的170000个样本数作为运行空间，足够存下所有观测样本。每次读取完毕记录有效样本数（文件行数）kp，循环反演是只对 1~kp 进行反演。</p> <hr> <h2 id="调用反演子程序"><a href="#调用反演子程序" class="header-anchor">#</a> - 调用反演子程序</h2> <p>对每个观测样本，都会对12个通道进行循环，调用核心反演子程序<code>core-iteration.f</code>的<code>core_iteration</code>函数,在主程序的最末尾用include语句引入：</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>       <span class="token keyword">call</span> core_iteration<span class="token punctuation">(</span>F<span class="token punctuation">,</span>newL<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>IHV<span class="token punctuation">,</span>PMB<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TK<span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">+</span>              RH<span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Z<span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lst<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>WND<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">+</span>             CldWtr<span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CldIce<span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">+</span>             Rain<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Snow<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">+</span>             Graupel<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span>newl<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tb0<span class="token punctuation">,</span>TW1<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>TW2<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>mlse<span class="token punctuation">)</span>
     
     .....
     <span class="token keyword">include</span><span class="token string">'./core-iteration.f'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr> <h2 id="迭代反演"><a href="#迭代反演" class="header-anchor">#</a> -迭代反演</h2> <p>下面是最核心的迭代反演部分，位于<code>core-iteration.f</code>中，采用的是二分查找算法的思想：</p> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>            minE <span class="token operator">=</span> <span class="token number">0.75</span>     <span class="token comment">!!!!设置MLSE最小的有效值是0.75</span>
            maxE <span class="token operator">=</span> <span class="token number">1.05</span>     <span class="token comment">!!!!设置MLSE最大的有效值是1.05</span>
	   
	  <span class="token comment">!!!调用MWRT模式计算minE，maxE对应的天顶亮温 mintb和maxtb</span>
	     <span class="token keyword">call</span>  mwstrm4<span class="token punctuation">(</span>F<span class="token punctuation">,</span>newL<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>LOUT<span class="token punctuation">,</span>IHV<span class="token punctuation">,</span>U<span class="token punctuation">,</span>PMB<span class="token punctuation">,</span>TK<span class="token punctuation">,</span>RH<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>TS<span class="token punctuation">,</span>IS<span class="token punctuation">,</span>minE<span class="token punctuation">,</span>WND<span class="token punctuation">,</span> <span class="token punctuation">&amp;</span>
            CldWtr<span class="token punctuation">,</span>CldIce<span class="token punctuation">,</span>Rain<span class="token punctuation">,</span>Snow<span class="token punctuation">,</span>Graupel<span class="token punctuation">,</span><span class="token punctuation">&amp;</span>
            MixingRule<span class="token punctuation">,</span>TB<span class="token punctuation">,</span>TW1<span class="token punctuation">,</span>TW2<span class="token punctuation">,</span>EMISS<span class="token punctuation">,</span>WK<span class="token punctuation">,</span>SurfModel<span class="token punctuation">,</span>IO<span class="token punctuation">,</span>retcode<span class="token punctuation">)</span>
	              mintb <span class="token operator">=</span> TB<span class="token punctuation">(</span>vh<span class="token punctuation">)</span> 			  
		          TB <span class="token operator">=</span><span class="token number">0.0</span>
         <span class="token keyword">CALL</span> MWSTRM4<span class="token punctuation">(</span>F<span class="token punctuation">,</span>newL<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>LOUT<span class="token punctuation">,</span>IHV<span class="token punctuation">,</span>U<span class="token punctuation">,</span>PMB<span class="token punctuation">,</span>TK<span class="token punctuation">,</span>RH<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>TS<span class="token punctuation">,</span>IS<span class="token punctuation">,</span>maxE<span class="token punctuation">,</span>WND<span class="token punctuation">,</span> <span class="token punctuation">&amp;</span>
            CldWtr<span class="token punctuation">,</span>CldIce<span class="token punctuation">,</span>Rain<span class="token punctuation">,</span>Snow<span class="token punctuation">,</span>Graupel<span class="token punctuation">,</span><span class="token punctuation">&amp;</span>
            MixingRule<span class="token punctuation">,</span>TB<span class="token punctuation">,</span>TW1<span class="token punctuation">,</span>TW2<span class="token punctuation">,</span>EMISS<span class="token punctuation">,</span>WK<span class="token punctuation">,</span>SurfModel<span class="token punctuation">,</span>IO<span class="token punctuation">,</span>retcode<span class="token punctuation">)</span>		   
                  maxtb <span class="token operator">=</span> TB<span class="token punctuation">(</span>vh<span class="token punctuation">)</span>
				  TB <span class="token operator">=</span><span class="token number">0.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>
 minor<span class="token punctuation">:</span><span class="token keyword">if</span>  <span class="token punctuation">(</span> mintb <span class="token operator">.ge.</span> tb0 <span class="token punctuation">)</span><span class="token keyword">then</span>       <span class="token comment">!!!!如果天顶观测亮温小于等于mintb</span>
			      mde <span class="token operator">=</span> <span class="token number">0.75</span>            <span class="token comment">!!!就取MLSE=0.75为反演结果</span>
	   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>maxtb <span class="token operator">.le.</span> tb0<span class="token punctuation">)</span> <span class="token keyword">then</span>    <span class="token comment">!!!!如果天顶观测亮温大于等于maxtb</span>
				  mde <span class="token operator">=</span> <span class="token number">1.05</span>            <span class="token comment">!!!就取MLSE=1.05为反演结果</span>
	   <span class="token keyword">else</span>            <span class="token comment">!!如果tb0在（mintb,maxtb）之间，则开始二分迭代查找</span>
				
           delta_tb <span class="token operator">=</span> <span class="token number">1.0</span>  
                             <span class="token comment">!!!模拟输出和天顶亮温之间的相对误差，初始化为1</span>
           mdE <span class="token operator">=</span> minE<span class="token operator">+</span><span class="token punctuation">(</span>maxE<span class="token operator">-</span>minE<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.618</span>
                         <span class="token comment">!!!利用0.618的比例计算第一个二分点，作为mlse的猜测值</span>
           i<span class="token operator">=</span> <span class="token number">0</span>          <span class="token comment">!!!迭代次数     </span>
       <span class="token comment">!!! do iteration:   </span>
       inter<span class="token punctuation">:</span><span class="token keyword">do</span> <span class="token keyword">while</span><span class="token punctuation">(</span>abs<span class="token punctuation">(</span>delta_tb<span class="token punctuation">)</span> <span class="token operator">.gt.</span> <span class="token number">0.001</span><span class="token punctuation">)</span> 
                           <span class="token comment">!!!如果相对误差小于0.001就结束迭代，满足精度      </span>
			i<span class="token operator">=</span> i <span class="token operator">+</span><span class="token number">1</span> 
		<span class="token comment">!!!调用MWRT模式的被动微波传输模块，模拟计算mdE猜测对应的模拟天顶亮温mdtb</span>
          <span class="token keyword">CALL</span> MWSTRM4<span class="token punctuation">(</span>F<span class="token punctuation">,</span>newL<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>LOUT<span class="token punctuation">,</span>IHV<span class="token punctuation">,</span>U<span class="token punctuation">,</span>PMB<span class="token punctuation">,</span>TK<span class="token punctuation">,</span>RH<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>TS<span class="token punctuation">,</span>IS<span class="token punctuation">,</span>mdE<span class="token punctuation">,</span>WND<span class="token punctuation">,</span><span class="token punctuation">&amp;</span>
               CldWtr<span class="token punctuation">,</span>CldIce<span class="token punctuation">,</span>Rain<span class="token punctuation">,</span>Snow<span class="token punctuation">,</span>Graupel<span class="token punctuation">,</span><span class="token punctuation">&amp;</span>
               MixingRule<span class="token punctuation">,</span>TB<span class="token punctuation">,</span>TW1<span class="token punctuation">,</span>TW2<span class="token punctuation">,</span>EMISS<span class="token punctuation">,</span>WK<span class="token punctuation">,</span>SurfModel<span class="token punctuation">,</span>IO<span class="token punctuation">,</span>retcode<span class="token punctuation">)</span>	
                 mdtb <span class="token operator">=</span> TB<span class="token punctuation">(</span>vh<span class="token punctuation">)</span>
                  TB <span class="token operator">=</span> <span class="token number">0.0</span>
    
		      delta_TB <span class="token operator">=</span> <span class="token punctuation">(</span>tb0<span class="token operator">-</span>mdTB<span class="token punctuation">)</span><span class="token operator">/</span>tb0 <span class="token comment">!!!计算相对误差，作为是否继续迭代的条件</span>

			   <span class="token keyword">if</span> <span class="token punctuation">(</span>abs<span class="token punctuation">(</span>delta_tb<span class="token punctuation">)</span> <span class="token operator">.le.</span> <span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
			        <span class="token keyword">goto</span> <span class="token number">110</span>       <span class="token comment">!!!满足精度跳出,mde输出作为反演结果</span>
			      <span class="token keyword">end if</span>
			      
			   <span class="token comment">!!!不满足精度要求，选取下一个二分点，调整查找区间     </span>
			   <span class="token keyword">if</span> <span class="token punctuation">(</span>mdtb <span class="token operator">.lt.</span> tb0<span class="token punctuation">)</span> <span class="token keyword">then</span>      
			       minE <span class="token operator">=</span> mdE
			       mdE  <span class="token operator">=</span> minE<span class="token operator">+</span><span class="token punctuation">(</span>maxE<span class="token operator">-</span>minE<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.618</span>  
			   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mdtb <span class="token operator">.gt.</span> tb0<span class="token punctuation">)</span> <span class="token keyword">then</span>
			       maxE <span class="token operator">=</span> mdE
			       mdE  <span class="token operator">=</span> minE<span class="token operator">+</span><span class="token punctuation">(</span>maxE<span class="token operator">-</span>minE<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.618</span> 
			   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mdtb <span class="token operator">.eq.</span> tb0<span class="token punctuation">)</span> <span class="token keyword">then</span>
				   <span class="token keyword">goto</span> <span class="token number">110</span>
			   <span class="token keyword">endif</span>
			   
      		    <span class="token comment">!!!如果迭代次数超过20次就跳出，避免未知原因死循环</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">.gt.</span> <span class="token number">20</span><span class="token punctuation">)</span>	<span class="token keyword">then</span> 
                 	<span class="token keyword">exit</span>
                <span class="token keyword">end if</span> 					
              <span class="token keyword">end do</span> inter
    <span class="token keyword">endif</span> minor
<span class="token number">110</span>          <span class="token keyword">continue</span>
		     MLSE <span class="token operator">=</span> mde   <span class="token comment">!!!跳出迭代后的mde就是满足精度要求的MLSE</span>
        <span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>注意，如果你要修改，请反复考虑逻辑顺序，容易出错。尤其是多迭代一次，少迭代一次差别很大。</p> <p>如果你想要更高的MLSE精度，可以将0.001改为0.0001，不过这样很慢很多，迭代次数多很多。</p> <p>你也可以修改有效MLSE 的范围[0.75,1.05]。</p> <hr> <h2 id="迭代参数设置"><a href="#迭代参数设置" class="header-anchor">#</a> - 迭代参数设置</h2> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  	     <span class="token keyword">parameter</span><span class="token punctuation">(</span>is   <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>       <span class="token comment">!!!陆地条件，给定MLSE</span>
         <span class="token keyword">parameter</span><span class="token punctuation">(</span>IO   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>       <span class="token comment">!!!双极化输出</span>
         <span class="token keyword">parameter</span><span class="token punctuation">(</span>LOUT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>       <span class="token comment">!!!天顶层输出</span>
         <span class="token keyword">parameter</span><span class="token punctuation">(</span>pi   <span class="token operator">=</span> acos<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">!!!PI=3.1415926......</span>
         <span class="token keyword">parameter</span><span class="token punctuation">(</span>U    <span class="token operator">=</span> cos<span class="token punctuation">(</span><span class="token number">55.0</span><span class="token operator">*</span>pi<span class="token operator">/</span><span class="token number">180.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">!!!根据卫星入射角修改：55度</span>
         MixingRule <span class="token operator">=</span><span class="token string">'EV'</span>           <span class="token comment">!冰晶混合模型 equivalent volume solid sphere</span>
          SurfModel  <span class="token operator">=</span><span class="token string">'F'</span>           <span class="token comment">!表面模型 fresnel </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr> <h2 id="数据说明"><a href="#数据说明" class="header-anchor">#</a> - 数据说明</h2> <div class="language-fortran line-numbers-mode"><pre class="language-fortran"><code>  <span class="token keyword">write</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span> ip<span class="token punctuation">,</span>newl<span class="token punctuation">,</span>qc<span class="token punctuation">,</span>lon<span class="token punctuation">,</span>lat<span class="token punctuation">,</span><span class="token punctuation">(</span>MLSEs<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>tb<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&amp;</span>
            cwc<span class="token punctuation">,</span>cic<span class="token punctuation">,</span>tw1<span class="token punctuation">,</span>tw2<span class="token punctuation">,</span>lst<span class="token punctuation">,</span>stime<span class="token punctuation">,</span>t2m<span class="token punctuation">,</span>land
<span class="token number">100</span>     <span class="token keyword">format</span><span class="token punctuation">(</span><span class="token number">3</span>I6<span class="token punctuation">,</span><span class="token number">50</span>F12.<span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>ip   integer型 每个AMSR-E数据点所拥有的唯一ID；  
newl integer型 样本对应的大气廓线层数；  

qc   integer型 cloud quality control ：  
           qc = 0 ;clear sky
           qc = 1 ; pure water cloud   
           qc = 2 ; pure ice cloud  
           qc = 3 ; mixed cloud exist  
           qc = 4 ; uncertain cloud exist  

lon  float 经度；  
lat  float 纬度；  

cwc  float 云液态水柱积分 g/cm2  手动计算；  
cic  float 云冰水柱积分   g/cm2  手动计算；  
tw1  float 云液态水柱积分 g/cm2  模式输出；  
tw2  float 云冰水柱积分   g/cm2  模式输出；  

lst  float  地表温度 k；  
t2m  float  两米温度 k；  

stime  float   扫描时间 hr （UTC）；  
landflag  float  陆地分数 0-100；  

tb    float(12) 12个通道天顶亮温观测；  
mlse  float(12) 12个通道地表微博比辐射率反演结果； 

tbsurf 即表面微波亮温计算公式:   tbsurf=LST*MLSE 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>示例：</p> <div class="language-gfortran line-numbers-mode"><pre class="language-text"><code>    27    26     4  143.770706   49.828499    0.979168    0.922625    0.976729    0.927505    0.968834    0.921118    0.966395    0.918678    0.945731    0.898012    0.900451    0.864577  251.710007  237.699997  251.020004  238.710007  249.220001  237.350006  248.490005  237.250000  243.710007  233.589996  233.050003  226.350006    5.158600   35.225201    5.150699   35.212990  256.891815    2.666700  252.000198   94.000000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>你会发现很多MLSE值是一样的，不要奇怪，根据我们设定的0.001的精度，0.75和1.05之间的迭代次数十分有限，如果亮温差异在3k以内左右，得到的 MLSE很可能是一样的。并且整个MLSE 的取值是离散的，因为在有限次迭代以后，mlse取到的值都是一定的。</p> <hr> <h3 id="利用fortran读取"><a href="#利用fortran读取" class="header-anchor">#</a> 利用fortran读取</h3> <div class="language-fortran 77 line-numbers-mode"><pre class="language-fortran"><code><span class="token comment">!! F77(fixed form) code</span>
       <span class="token keyword">integer</span>   ip<span class="token punctuation">,</span>newl<span class="token punctuation">,</span>qc<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j
       <span class="token keyword">real</span>      lon<span class="token punctuation">,</span>lat
       <span class="token keyword">real</span>      cwc<span class="token punctuation">,</span>cic<span class="token punctuation">,</span>tw1<span class="token punctuation">,</span>tw2<span class="token punctuation">,</span>lst<span class="token punctuation">,</span>t2m
       <span class="token keyword">real</span>      mlse<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tb<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>stime<span class="token punctuation">,</span>landflag 

<span class="token number">1100</span>    <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">end</span><span class="token operator">=</span><span class="token number">1101</span><span class="token punctuation">)</span> ip<span class="token punctuation">,</span>newl<span class="token punctuation">,</span>qc<span class="token punctuation">,</span>lon<span class="token punctuation">,</span>lat<span class="token punctuation">,</span>
     <span class="token operator">+</span>               <span class="token punctuation">(</span>mlse<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>tb<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">+</span>               cwc<span class="token punctuation">,</span>cic<span class="token punctuation">,</span>tw1<span class="token punctuation">,</span>tw2<span class="token punctuation">,</span>lst<span class="token punctuation">,</span>stime<span class="token punctuation">,</span>t2m<span class="token punctuation">,</span>landflag
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="利用ncl读取"><a href="#利用ncl读取" class="header-anchor">#</a> 利用NCL读取</h3> <div class="language-ncl line-numbers-mode"><pre class="language-text"><code>    filein=&quot;./mlse.land98.res1/mlse.land98.res1.200804&quot;+dd+&quot;.txt&quot;      
     nrows = numAsciiRow(filein); 读取行数
     ncols = numAsciiCol(filein); 读取列数

     array = asciiread(filein,(/nrows,ncols/),&quot;float&quot;) ;  读取数据阵
     ;分配变量
     ip    = floattoint(array(:,0)); 
     newl  = floattoint(array(:,2-1)); 
     qc    = floattoint(array(:,3-1));         
     flon  = array(:,4-1);   
     flat  = array(:,5-1);   
     mlse  = array(:,6-1:17-1);   
     tb    = array(:,18-1:29-1); 
     cwc   = array(:,30-1); 
     cic   = array(:,31-1); 
     tw1   = array(:,32-1); 
     tw2   = array(:,33-1); 
     lst   = array(:,34-1); 
     stime = array(:,35-1); 
     t2m   = array(:,36-1); 
     land  = array(:,37-1); 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <p>最终结果</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4mqxf45haj313308jdm4.jpg"> <p style="text-align:center;"> lwp iwp lst rain</p> <img src="https://ws1.sinaimg.cn/large/005zDzHply1g4mr0jp46rj30z90n1as7.jpg"> <h2 id="amsr-e-反演得到的-mlse-空间分布。个例时间：-2008-年-4-月-26-日。上中下：垂直极化通道，水平极化通道和对应频率的极化差。从左往右：-6-925、-10-65、-18-7、-23-8-和36-5-ghz"><a href="#amsr-e-反演得到的-mlse-空间分布。个例时间：-2008-年-4-月-26-日。上中下：垂直极化通道，水平极化通道和对应频率的极化差。从左往右：-6-925、-10-65、-18-7、-23-8-和36-5-ghz" class="header-anchor">#</a> <p style="text-align:center;"> AMSR-E 反演得到的 MLSE 空间分布。个例时间： 2008 年 4 月 26 日。上中下：垂直极化通道，水平极化通道和对应频率的极化差。从左往右： 6.925、 10.65、 18.7、 23.8 和
36.5 GHz </p></h2> <p>©jihenghu 2019</p></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/jihenghu/jihenghu.github.io/edit/master/docs/document/mlse-ae/retrieve.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#内容" class="sidebar-link" data-v-40a3448a>- 内容</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#运行方式" class="sidebar-link" data-v-40a3448a>- 运行方式</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#读取上游数据" class="sidebar-link" data-v-40a3448a>- 读取上游数据</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#调用反演子程序" class="sidebar-link" data-v-40a3448a>- 调用反演子程序</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#迭代反演" class="sidebar-link" data-v-40a3448a>-迭代反演</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#迭代参数设置" class="sidebar-link" data-v-40a3448a>- 迭代参数设置</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#数据说明" class="sidebar-link" data-v-40a3448a>- 数据说明</a></li><li class="level-3" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#利用fortran读取" class="sidebar-link" data-v-40a3448a>利用fortran读取</a></li><li class="level-3" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#利用ncl读取" class="sidebar-link" data-v-40a3448a>利用NCL读取</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#附录" class="sidebar-link" data-v-40a3448a>附录</a></li><li class="level-2" data-v-40a3448a><a href="/document/mlse-ae/retrieve.html#amsr-e-反演得到的-mlse-空间分布。个例时间：-2008-年-4-月-26-日。上中下：垂直极化通道，水平极化通道和对应频率的极化差。从左往右：-6-925、-10-65、-18-7、-23-8-和36-5-ghz" class="sidebar-link" data-v-40a3448a>AMSR-E 反演得到的 MLSE 空间分布。个例时间： 2008 年 4 月 26 日。上中下：垂直极化通道，水平极化通道和对应频率的极化差。从左往右： 6.925、 10.65、 18.7、 23.8 和
36.5 GHz</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.84efe3cb.js" defer></script><script src="/assets/js/3.a3aaa010.js" defer></script><script src="/assets/js/1.f6ff2096.js" defer></script><script src="/assets/js/28.f3b6cf79.js" defer></script>
  </body>
</html>
