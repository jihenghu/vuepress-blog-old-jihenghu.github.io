(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{334:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#文件夹内容"}},[t._v("- 文件夹内容")])]),a("li",[a("a",{attrs:{href:"#运行方式"}},[t._v("- 运行方式")])]),a("li",[a("a",{attrs:{href:"#preprocess-2a-ncl"}},[t._v("- preprocess.2a.ncl")])]),a("li",[a("a",{attrs:{href:"#ascii2d-writeout-f"}},[t._v("- ascii2d_writeout.f")])]),a("li",[a("a",{attrs:{href:"#数据说明"}},[t._v("- 数据说明")])]),a("li",[a("a",{attrs:{href:"#建议和问题"}},[t._v("- 建议和问题")])]),a("li",[a("a",{attrs:{href:"#附录"}},[t._v("附录")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"文件夹内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件夹内容"}},[t._v("#")]),t._v(" - 文件夹内容")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("+data  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#存储处理过的2A数据，txt格式")]),t._v("\n- preprocess.2a.ncl  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#主要的处理程序，NCL语言编写")]),t._v("\n- ascii2d_writeout.f  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用fortran77 编写的NCL子程序，用于格式化输出")]),t._v("\n- ascii2d_writeout.so  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用WRAPIT生成的动态库文件，preprocess.2a.ncl会引用此动态库进行格式化输出")]),t._v("\n- batch.sh  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#批量控制脚本，shell语法，用于对大批量的日期进行操作")]),t._v("\n- show.amsre.scantime.ncl "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#单轨轨道示意图代码（不是主要代码）")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"运行方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行方式"}},[t._v("#")]),t._v(" - 运行方式")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("单个日期处理（如2004年1月1日)")]),t._v(" "),a("p",[t._v("NCL带参运行 yyyymmdd=20040101")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ncl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("yyyymmdd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040101")]),t._v(" preprocess.2a.ncl \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\tyyyymmdd:20040101\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\thdf files: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\tDone with "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040101")]),t._v("-------------------------\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("运行结果：data文件夹下出现"),a("code",[t._v("AEL2A.masked.TB.res1.20040101.txt")]),t._v("，任务完成。")])]),t._v(" "),a("li",[a("p",[t._v("批量日期处理（如20040102~20040103）")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("batch.sh")]),t._v("脚本")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sh")]),t._v(" batch.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040102")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040103")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040102")]),t._v("                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#batch.sh 输出信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\tyyyymmdd:20040102                                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#NCL脚本输出信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\thdf files: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\tDone with "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040102")]),t._v("-------------------------\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040103")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\tyyyymmdd:20040103\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\thdf files: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\tDone with "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040103")]),t._v("-------------------------\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("运行结果：data文件夹下出现")]),t._v(" "),a("p",[a("code",[t._v("AEL2A.masked.TB.res1.20040102.txt")])]),t._v(" "),a("p",[a("code",[t._v("AEL2A.masked.TB.res1.20040103.txt")])]),t._v(" "),a("p",[t._v("对于批量来说，为了发挥机器资源，建议没半年或一年一个批量，这一部分的处理速度还是很快的。")]),t._v(" "),a("p",[t._v("也可以放在后台运行，不过这部分数据处理速度较快，一般不需要放进后台：")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nohup")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" batch.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040102")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040103")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" log.20040102-20040103 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"preprocess-2a-ncl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preprocess-2a-ncl"}},[t._v("#")]),t._v(" - "),a("code",[t._v("preprocess.2a.ncl")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("根据ROI (Region of Interest)裁剪轨道:")]),t._v(" "),a("div",{staticClass:"language-NCL line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(";;;获得轨道的四至点行列下标\nji = region_ind(Latitude_Low_Res_2d,Longitude_Low_Res_2d, latS, latN, lonW, lonE)  \n            jStrt = ji(0)      ; lat start\n            jLast = ji(1)      ; lat last\n            iStrt = ji(2)      ; lon start\n            iLast = ji(3)      ; lon last\nLAT2D = Latitude_Low_Res_2d(jStrt:jLast,iStrt:iLast)\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("使用函数"),a("code",[t._v("region_ind")]),t._v("和ROI的四至来计算"),a("code",[t._v("ji")]),t._v(",是一个四元数组，和图1中的对应关系是：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jStrt => minScan\njLast => maxScan\niStrt => minCol\niLast => maxCol\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("使用"),a("code",[t._v("(jStrt:jLast,iStrt:iLast)")]),t._v("下标范围确定的区域即为图1中的阴影区域，并且这几个轨道的阴影区是相连的（上行轨道最右侧的轨道是最早过境的，左边的过境稍晚）。轨道的其他部分被裁剪掉，")]),t._v(" "),a("img",{staticStyle:{width:"500px",height:"300px"},attrs:{src:"https://ws1.sinaimg.cn/large/005zDzHply1g4fot8ifoij30j70dpwfd.jpg"}})])]),t._v(" "),a("p",{staticStyle:{"text-align":"center"}},[t._v("图1. 使用ji剪裁出的轨道")]),t._v(" "),a("p",[t._v("使用经纬度确定好下标范围以后，提取其他参数直接按下标提取需要的部分，节省内存开销，如：")]),t._v(" "),a("div",{staticClass:"language-NCL line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("time0  = hdfile[:]->Time_Low_Res_Swath(jStrt:jLast) \t\n landoceanres=hdfile[:]->Land_Ocean_Flag(jStrt:jLast,iStrt:iLast,0) \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("进一步地，对ROI外的样本进行缺测：")]),t._v(" "),a("div",{staticClass:"language-NCL line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("landocean = where(LAT2D .lt. latS .or. \\\n\t                 LAT2D .gt. latN .or. \\\n\t                 LON2D .lt. lonW .or. \\\n\t                 LON2D .gt. lonE ,fillvalue ,landocean)\t \nlandocean@_FillValue = fillvalue\t\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("后期在输出时判断是否为缺测即可仅仅保留ROI内的观测样本。效果如图2：")]),t._v(" "),a("img",{staticStyle:{width:"500px",height:"300px"},attrs:{src:"https://ws1.sinaimg.cn/large/005zDzHply1g4fpoi9qh2j30m60g60tv.jpg"}}),t._v(" "),a("p",{staticStyle:{"text-align":"center"}},[t._v("图2. 进一步去除不需要的ROI外样本")]),t._v(" "),a("p",[t._v("看看实际效果加强理解:")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ncl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("yyyymmdd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20040101")]),t._v(" show.amsre.scantime.ncl \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("img",{staticStyle:{width:"500px",height:"300px"},attrs:{src:"https://ws1.sinaimg.cn/large/005zDzHply1g4fuk3z5fpj30nx0grq5s.jpg"}}),t._v(" "),a("p",{staticStyle:{"text-align":"center"}},[t._v("图3.实际的轨道剪切和缺测情况，单轨")]),t._v(" "),a("p",[t._v("可以看出轨道剪切的范围在ROI之外，但是外部已经被缺测了，这部分不会输出。")]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"ascii2d-writeout-f"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ascii2d-writeout-f"}},[t._v("#")]),t._v(" - "),a("code",[t._v("ascii2d_writeout.f")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("使用F77编写的NCL子程序，使用"),a("strong",[t._v("WRAPT")]),t._v("打包成动态库 "),a("code",[t._v("ascii2d_writeout.so")]),t._v("，详见"),a("a",{attrs:{href:"http://www.ncl.ucar.edu/Document/Tools/WRAPIT.shtml",target:"_blank",rel:"noopener noreferrer"}},[t._v("NCL-WRAPIT"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("主要是使用 NCLFORTSTART语句包装F77子程序的函数名和声明部分，")]),t._v(" "),a("div",{staticClass:"language-fortran 77 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-fortran"}},[a("code",[t._v("C       NCLFORTSTART\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("subroutine")]),t._v(" ascii2d_writeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dims"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("...."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" dims "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("...\nC       NCLEND\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!!!"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("END")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("还用WRAPIT命令打包成动态库"),a("code",[t._v(".so")]),t._v("文件：")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$WRAPIT")]),t._v(" ascii2d_writeout.f\nWRAPIT Version: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120209")]),t._v("\nCOMPILING ascii2d_writeout.f\nLINKING\nEND WRAPIT\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("成功，当前目录出现，"),a("code",[t._v("ascii2d_writeout.so")]),t._v("文件。")])]),t._v(" "),a("li",[a("p",[t._v("NCL调用，"),a("code",[t._v("preprocess.2a.ncl")]),t._v("中")]),t._v(" "),a("div",{staticClass:"language-NCL line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('external SUB "./ascii2d_writeout.so"   ;;;头部引入\nbegin\n.....\nSUB::ascii2d_writeout(dims,....)       ;;;CALL F77 subroutine 格式要和声明一直\nend\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("注意！！！每次修改完ascii2d_writeout.f文件要重新打包成"),a("code",[t._v(".so")]),t._v("否则不生效。")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"数据说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据说明"}},[t._v("#")]),t._v(" - 数据说明")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("对于AE-L2A的处理，最终输出的数据特征有：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("包含全部land_ocean_flag 大于80%的样本，后来证明陆地要求至少98%，后期做了筛选。不过陆地比例范围发也是有利用价值的。")])]),t._v(" "),a("li",[a("p",[t._v("包含Aqua的上行轨道样本，过境时间一般在当地时14:00左右，具体以ScanTime为准。")])]),t._v(" "),a("li",[a("p",[t._v("卫星的地面入射角为52.8度。")])]),t._v(" "),a("li",[a("p",[t._v("亮温通道顺序为：（v 垂直极化；h水平极化 ； 单位GHz）")]),t._v(" "),a("div",{staticClass:"language-normal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"6.9v","6.9h","10.7v","10.7h","18.7v","18.7h","23.8v","23.8h","36.5v","36.5h","89.0v","89.0h"\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("输出参数包含样本序号，经纬度，扫描时间，陆地分数，12通道亮温等，详见表1。")]),t._v(" "),a("p",[a("strong",[t._v("表1. 输出参数详情")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("参数")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ip")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("lon")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("lat")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("TBs")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("scanTime")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("landFlag")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("说明")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("序号")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("经度")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("纬度")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("12通道亮温")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("扫描时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("陆地分数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("有效范围")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("自然数")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("70-145")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("10-55")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("100K-300 K")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("UTC时间（单位小时）")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0-100")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("输出类型")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("I6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("F12.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("F12.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("12F12.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("F12.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("F12.6")])])])])]),t._v(" "),a("li",[a("p",[t._v("输出文件示例：")]),t._v(" "),a("p",[a("code",[t._v("AEL2A.masked.TB.res1.20040101.txt")]),t._v("，格式化ascii文件。")]),t._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("    22  143.824844   49.743305  251.199997  236.269989  250.589996  237.440002  249.099991  236.299988  248.380005  236.319992  243.739990  232.899994  233.130005  225.910004    2.666667   95.000000\n    \n    23  143.784378   49.665657  251.119995  236.519989  250.319992  237.169998  248.579987  235.720001  247.549988  235.559998  242.039993  231.369995  229.410004  222.410004    2.666667  100.000000\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[a("code",[t._v("ascii2d_writeout.f")]),t._v("中以上参数按序输出：")]),t._v(" "),a("div",{staticClass:"language-fortran 77 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-fortran"}},[a("code",[t._v("          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lon1d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lat1d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tbs1d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("j"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("               Time_1D"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" landflag1d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("I6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("F12."),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"建议和问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建议和问题"}},[t._v("#")]),t._v(" - 建议和问题")]),t._v(" "),a("ul",[a("li",[t._v("每次按照需求改定代码是，最好在格式化输出之前输出成NetCDF文件或者画图check一下样本筛选是否符合心理预期，检查数据时候正常。反复检查和后续回头检查都是好习惯，途径就是画图诊断。注意，在画图check的时候不要给地图填色，可以看到海洋，湖泊是否有样本。")]),t._v(" "),a("li",[t._v("为什么输出成ascii文件而不是别的？这主要是方便检查每一个样本的各个参数是否有问题，在后续的处理中经常会遇到需要检查经纬度是否在区域内或者边缘；检查数值大小，分布情况是否合理，都有助于debug。但是输出成NC文件不利于后续使用fortran代码读取，输出成二进制是一个好办法，对于三维参数输出使用这种方案，但是不直观。这是沿袭李老师最开始的风格。")]),t._v(" "),a("li",[t._v("为何使用fortran子程序去写出数据，这么麻烦？因为fortran的格式化输出很快，而且友好。当然你也可以使用NCL自带的"),a("code",[t._v("write_table")]),t._v("函数来循环读写，但是有点慢，"),a("code",[t._v("write_table")]),t._v("是唯一一个可以往已存在文件尾部add数据记录的ascii写函数。")]),t._v(" "),a("li",[t._v("为什么要做轨道的剪切？因为动辄6，7条全球轨道拼在一起很吃内存，甚至有时候会segment fault，这样剪切以后就是小数组，操作也快很多，下标操作很快的。")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"附录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[t._v("#")]),t._v(" 附录")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("batch.sh")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("first")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("second")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$first")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$second")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$first")]),t._v("\n    ncl -Q "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("yyyymmdd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${first}")]),t._v(" preprocess.2a.ncl\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("first")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-1 days ago '),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${first}")]),t._v('"')]),t._v(" +%Y%m%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$second")]),t._v("\nncl -Q "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("yyyymmdd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${second}")]),t._v("  preprocess.2a.ncl\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("AE-L2A全球扫描时间")]),t._v(" "),a("img",{staticStyle:{width:"500px",height:"300px"},attrs:{src:"https://ws1.sinaimg.cn/large/005zDzHply1g4fpjkmgvuj30r40go7cu.jpg"}})]),t._v(" "),a("li",[a("p",[t._v("中国地区Scantime")]),t._v(" "),a("img",{staticStyle:{width:"500px",height:"300px"},attrs:{src:"https://ws1.sinaimg.cn/large/005zDzHply1g4fpkiwhrjj30p20hun1m.jpg"}})]),t._v(" "),a("li",[a("p",[t._v("亮温")]),t._v(" "),a("img",{staticStyle:{width:"500px",height:"500px"},attrs:{src:"https://ws1.sinaimg.cn/large/005zDzHply1g4fpm27956j30sg0sg7ms.jpg"}})])]),t._v(" "),a("p",[t._v("© Jihenghu 2019")])])}),[],!1,null,null,null);s.default=n.exports}}]);